require('dotenv').config();
const mongoose = require('mongoose');
const User = require('./models/User');
const Course = require('./models/Course');

const connectDB = async () => {
  try {
    await mongoose.connect(process.env.MONGODB_URI, {
      useNewUrlParser: true,
      useUnifiedTopology: true,
    });
    console.log('MongoDB Connected for seeding');
  } catch (error) {
    console.error('Database connection error:', error);
    process.exit(1);
  }
};

const seedAdmin = async () => {
  try {
    // Check if admin already exists
    const existingAdmin = await User.findOne({ 
      email: process.env.ADMIN_EMAIL 
    });

    if (existingAdmin) {
      console.log('Admin user already exists:', existingAdmin.email);
      return;
    }

    // Create admin user
    const admin = new User({
      email: process.env.ADMIN_EMAIL,
      password: process.env.ADMIN_PASSWORD,
      firstName: 'Administrator',
      lastName: 'Systemu',
      role: 'admin',
      isActive: true,
      isVerified: true
    });

    await admin.save();
    console.log('‚úÖ Admin user created successfully:');
    console.log(`   Email: ${admin.email}`);
    console.log(`   Password: ${process.env.ADMIN_PASSWORD}`);
    console.log(`   Role: ${admin.role}`);
    
  } catch (error) {
    console.error('Error creating admin user:', error);
  }
};

const seedSampleData = async () => {
  try {
    // Create sample users
    const sampleUsers = [
      {
        email: 'wykladowca@bcu-spedycja.pl',
        password: 'Wykladowca123!',
        firstName: 'Jan',
        lastName: 'Kowalski',
        role: 'wykladowca',
        isActive: true,
        isVerified: true
      },
      {
        email: 'redaktor@bcu-spedycja.pl',
        password: 'Redaktor123!',
        firstName: 'Anna',
        lastName: 'Nowak',
        role: 'redaktor',
        isActive: true,
        isVerified: true
      },
      {
        email: 'pracodawca@bcu-spedycja.pl',
        password: 'Pracodawca123!',
        firstName: 'Piotr',
        lastName: 'Wi≈õniewski',
        role: 'pracodawca',
        companyName: 'Logistics Solutions Sp. z o.o.',
        isActive: true,
        isVerified: true
      }
    ];

    for (const userData of sampleUsers) {
      const existingUser = await User.findOne({ email: userData.email });
      if (!existingUser) {
        const user = new User(userData);
        await user.save();
        console.log(`‚úÖ Sample user created: ${user.email} (${user.role})`);
      } else {
        console.log(`‚ÑπÔ∏è  Sample user already exists: ${userData.email}`);
      }
    }

  } catch (error) {
    console.error('Error creating sample users:', error);
  }
};

const seedCourses = async () => {
  try {
    // Get admin user to assign as author
    const admin = await User.findOne({ role: 'admin' });
    if (!admin) {
      console.log('‚ö†Ô∏è  No admin user found, skipping course seeding');
      return;
    }

    // Remove all existing courses
    await Course.deleteMany({});
    console.log('üóëÔ∏è  Removed all existing courses');

    const courses = [
      {
        title: 'Kody kreskowe i ich rola w zarzƒÖdzaniu ≈Ça≈Ñcuchem dostaw',
        excerpt: 'Naucz siƒô wykorzystywaƒá kody kreskowe w zarzƒÖdzaniu magazynem i ≈Ça≈Ñcuchem dostaw. Poznaj r√≥≈ºne typy kod√≥w, technologie skanowania i systemy ≈õledzenia.',
        contentHTML: '<h2>Kody kreskowe w zarzƒÖdzaniu ≈Ça≈Ñcuchem dostaw</h2><p>Kompleksowy kurs dotyczƒÖcy wykorzystania kod√≥w kreskowych w nowoczesnej logistyce. Poznasz r√≥≈ºne standardy kod√≥w, technologie skanowania oraz systemy ≈õledzenia przesy≈Çek.</p><h3>Tematy:</h3><ul><li>Standardy kod√≥w kreskowych (EAN, UPC, Code 128)</li><li>Technologie skanowania i czytniki</li><li>Systemy WMS i integracja</li><li>Optymalizacja proces√≥w magazynowych</li><li>≈öledzenie przesy≈Çek w ≈Ça≈Ñcuchu dostaw</li></ul>',
        imageUrl: './imgs/warehouse-worker-checking-inventory-arrived-goods-packages-storage-department.jpg',
        weeks: 4,
        hours: 32,
        targetGroup: 'doro≈õli',
        maxParticipants: 20,
        
        status: 'published',
        tags: ['kody kreskowe', 'magazyn', 'WMS', 'skanowanie', '≈õledzenie'],
        author: admin._id
      },
      {
        title: 'Jak zarabiaƒá na transporcie? Kosztorysowanie i rozliczanie zlece≈Ñ',
        excerpt: 'Kompleksowy kurs kalkulacji koszt√≥w transportu. Poznaj metody wyceny zlece≈Ñ, optymalizacji tras i maksymalizacji zysk√≥w w dzia≈Çalno≈õci transportowej.',
        contentHTML: '<h2>Kosztorysowanie i rozliczanie w transporcie</h2><p>Praktyczny kurs dotyczƒÖcy wyceny us≈Çug transportowych. Nauczysz siƒô kalkulowaƒá koszty, optymalizowaƒá trasy oraz maksymalizowaƒá zyski z dzia≈Çalno≈õci przewozowej.</p><h3>Zagadnienia:</h3><ul><li>Kalkulacja koszt√≥w operacyjnych</li><li>Wycena zlece≈Ñ transportowych</li><li>Optymalizacja tras i planowanie</li><li>Analiza rentowno≈õci i mar≈ºy</li><li>Rozliczenia z klientami i podwykonawcami</li></ul>',
        imageUrl: './imgs/truck-logistics-operation-dusk.jpg',
        weeks: 6,
        hours: 48,
        targetGroup: 'doro≈õli',
        maxParticipants: 25,
        
        status: 'published',
        tags: ['kosztorysowanie', 'finanse', 'optymalizacja', 'zyski'],
        author: admin._id
      },
      {
        title: 'Eksport i import ≈Çadunk√≥w ‚Äì jak to robiƒá z g≈ÇowƒÖ?',
        excerpt: 'Poznaj procedury miƒôdzynarodowego handlu. Dowiedz siƒô o dokumentacji celnej, procedurach eksportowo-importowych i przepisach miƒôdzynarodowych.',
        contentHTML: '<h2>Eksport i import ≈Çadunk√≥w</h2><p>Kompleksowy przewodnik po miƒôdzynarodowym handlu towarami. Poznasz procedury celne, wymaganƒÖ dokumentacjƒô oraz przepisy regulujƒÖce handel zagraniczny.</p><h3>Program:</h3><ul><li>Procedury celne i dokumentacja</li><li>Incoterms 2020 w praktyce</li><li>Ubezpieczenia transportowe</li><li>Certyfikaty i licencje</li><li>Rozliczenia walutowe</li></ul>',
        imageUrl: './imgs/transportation-logistics-container-cargo-ship-cargo-plane.jpg',
        weeks: 7,
        hours: 56,
        targetGroup: 'doro≈õli',
        maxParticipants: 20,
        
        status: 'published',
        tags: ['eksport', 'import', 'c≈Ço', 'handel zagraniczny'],
        author: admin._id
      },
      {
        title: 'Automatyzacja i optymalizacja transportu bliskiego w magazynie',
        excerpt: 'Nowoczesne rozwiƒÖzania automatyzacji w magazynach. Poznaj systemy WMS, roboty magazynowe i technologie optymalizujƒÖce przep≈Çyw towar√≥w.',
        contentHTML: '<h2>Automatyzacja transportu magazynowego</h2><p>Kurs dotyczƒÖcy nowoczesnych technologii automatyzacji w magazynach. Poznasz systemy WMS, roboty magazynowe oraz rozwiƒÖzania IoT optymalizujƒÖce procesy logistyczne.</p><h3>Technologie:</h3><ul><li>Systemy WMS/WCS</li><li>Roboty magazynowe AGV/AMR</li><li>Technologie IoT i sensoryka</li><li>Sztuczna inteligencja w logistyce</li><li>Automatyczne systemy sortowania</li></ul>',
        imageUrl: './imgs/cargo-transport-robot-is-parked-floor-near-shelves-with-merchandise-spacious-warehouse-that-is-lit-night-by-generative-ai.jpg',
        weeks: 5,
        hours: 40,
        targetGroup: 'doro≈õli',
        maxParticipants: 18,
        
        status: 'published',
        tags: ['automatyzacja', 'WMS', 'roboty', 'IoT'],
        author: admin._id
      },
      {
        title: 'Jak lataƒá bez samolotu? Transport przesy≈Çek z wykorzystaniem bezza≈Çogowego statku powietrznego',
        excerpt: 'Przysz≈Ço≈õƒá dostaw dronem. Poznaj regulacje prawne, technologie dron√≥w cargo i mo≈ºliwo≈õci wykorzystania BSP w logistyce ostatniej mili.',
        contentHTML: '<h2>Transport dronami w logistyce</h2><p>Innowacyjny kurs o wykorzystaniu dron√≥w w transporcie przesy≈Çek. Poznasz regulacje prawne, technologie BSP oraz praktyczne zastosowania w logistyce ostatniej mili.</p><h3>Zagadnienia:</h3><ul><li>Regulacje prawne ULC i EASA</li><li>Technologie dron√≥w cargo</li><li>Planowanie tras i misji BSP</li><li>Bezpiecze≈Ñstwo operacji</li><li>Integracja z systemami logistycznymi</li></ul>',
        imageUrl: './imgs/drone-flying-modern-warehouse.jpg',
        weeks: 4,
        hours: 32,
        targetGroup: 'doro≈õli',
        maxParticipants: 15,
        
        status: 'published',
        tags: ['drony', 'BSP', 'innowacje', 'ostatnia mila'],
        author: admin._id
      },
      {
        title: 'Prowadzenie firmy spedycyjnej w zmieniajƒÖcym siƒô ≈õwiecie',
        excerpt: 'ZarzƒÖdzanie firmƒÖ spedycyjnƒÖ w dobie transformacji cyfrowej. Poznaj trendy, wyzwania i strategie rozwoju w nowoczesnej logistyce.',
        contentHTML: '<h2>Prowadzenie firmy spedycyjnej</h2><p>Strategiczny kurs dla przedsiƒôbiorc√≥w z bran≈ºy TSL. Poznasz nowoczesne metody zarzƒÖdzania, trendy rynkowe oraz strategie adaptacji do zmieniajƒÖcych siƒô warunk√≥w biznesowych.</p><h3>Tematy:</h3><ul><li>Transformacja cyfrowa w TSL</li><li>ZarzƒÖdzanie zmianƒÖ organizacyjnƒÖ</li><li>Strategie rozwoju i ekspansji</li><li>Analiza konkurencji</li><li>Zr√≥wnowa≈ºony rozw√≥j w logistyce</li></ul>',
        imageUrl: './imgs/transport-logistic-manager-checking-control-logistic-network-distribution-customer.jpg',
        weeks: 8,
        hours: 64,
        targetGroup: 'doro≈õli',
        maxParticipants: 20,
        
        status: 'published',
        tags: ['zarzƒÖdzanie', 'strategia', 'rozw√≥j', 'cyfryzacja'],
        author: admin._id
      },
      {
        title: 'Prawid≈Çowa realizacja obrotu towarowego z zagranicƒÖ ‚Äì export/import',
        excerpt: 'Procedury prawne handlu zagranicznego. Poznaj dokumentacjƒô celnƒÖ, certyfikaty, procedury VAT i compliance w handlu miƒôdzynarodowym.',
        contentHTML: '<h2>Realizacja obrotu z zagranicƒÖ</h2><p>Szczeg√≥≈Çowy kurs procedur prawnych w handlu zagranicznym. Poznasz wymagania dokumentacyjne, procedury celne oraz aspekty prawno-podatkowe handlu miƒôdzynarodowego.</p><h3>Procedury:</h3><ul><li>Dokumentacja celna i handlowa</li><li>Procedury VAT w UE i poza UE</li><li>Certyfikaty pochodzenia</li><li>Compliance i audyty celne</li><li>Procedury uprzywilejowane</li></ul>',
        imageUrl: './imgs/courier-with-delivery-cardboard-box-by-car.jpg',
        weeks: 6,
        hours: 48,
        targetGroup: 'doro≈õli',
        maxParticipants: 22,
        
        status: 'published',
        tags: ['prawo', 'export', 'import', 'dokumentacja'],
        author: admin._id
      },
      {
        title: 'Dob√≥r urzƒÖdze≈Ñ do mechanizacji prac ≈Çadunkowych',
        excerpt: 'Wyb√≥r i eksploatacja sprzƒôtu do prac ≈Çadunkowych. Poznaj r√≥≈ºne typy urzƒÖdze≈Ñ, kryteria doboru i zasady bezpiecznej eksploatacji.',
        contentHTML: '<h2>Mechanizacja prac ≈Çadunkowych</h2><p>Praktyczny kurs dotyczƒÖcy doboru i eksploatacji urzƒÖdze≈Ñ do prac ≈Çadunkowych. Poznasz r√≥≈ºne typy sprzƒôtu, kryteria ekonomiczne wyboru oraz zasady bezpiecznego u≈ºytkowania.</p><h3>UrzƒÖdzenia:</h3><ul><li>W√≥zki wid≈Çowe i ich typy</li><li>Suwnice i ≈ºurawie</li><li>Przeno≈õniki i transportery</li><li>Systemy automatyczne</li><li>Analiza koszt√≥w eksploatacji</li></ul>',
        imageUrl: './imgs/suwnica2.jpg',
        weeks: 5,
        hours: 40,
        targetGroup: 'doro≈õli',
        maxParticipants: 20,
        
        status: 'published',
        tags: ['mechanizacja', 'sprzƒôt', 'w√≥zki wid≈Çowe', 'bezpiecze≈Ñstwo'],
        author: admin._id
      },
      {
        title: 'Harmonogramowanie czynno≈õci manipulacyjnych w magazynie',
        excerpt: 'Optymalizacja proces√≥w magazynowych. Naucz siƒô planowania pracy, zarzƒÖdzania zasobami i harmonogramowania operacji w magazynie.',
        contentHTML: '<h2>Harmonogramowanie w magazynie</h2><p>Kurs optymalizacji proces√≥w magazynowych poprzez skuteczne planowanie i harmonogramowanie. Poznasz metody organizacji pracy i zarzƒÖdzania zasobami ludzkimi i technicznymi.</p><h3>Zagadnienia:</h3><ul><li>Planowanie operacji magazynowych</li><li>ZarzƒÖdzanie zasobami ludzkimi</li><li>Optymalizacja przep≈Çyw√≥w towarowych</li><li>KPI w magazynie</li><li>Systemy planowania zasob√≥w</li></ul>',
        imageUrl: './imgs/warehouse-operative-checking-purchase-order.jpg',
        weeks: 4,
        hours: 32,
        targetGroup: 'doro≈õli',
        maxParticipants: 25,
        
        status: 'published',
        tags: ['harmonogramowanie', 'planowanie', 'optymalizacja', 'KPI'],
        author: admin._id
      },
      {
        title: 'Automatyczna identyfikacja ≈Çadunk√≥w w procesie komisjonowania przesy≈Çek',
        excerpt: 'Nowoczesne technologie identyfikacji w komisjonowaniu. Poznaj systemy RFID, kody QR i inne technologie automatycznej identyfikacji.',
        contentHTML: '<h2>Automatyczna identyfikacja ≈Çadunk√≥w</h2><p>Zaawansowany kurs technologii automatycznej identyfikacji w procesach magazynowych. Poznasz systemy RFID, kody QR oraz inne nowoczesne rozwiƒÖzania wspierajƒÖce komisjonowanie.</p><h3>Technologie:</h3><ul><li>Systemy RFID i NFC</li><li>Kody QR i DataMatrix</li><li>Systemy pick-by-light/voice</li><li>Technologie wizyjne</li><li>Integracja z systemami WMS</li></ul>',
        imageUrl: './imgs/happy-employee-holding-scanner-distribution-warehouse.jpg',
        weeks: 5,
        hours: 40,
        targetGroup: 'doro≈õli',
        maxParticipants: 18,
        
        status: 'published',
        tags: ['RFID', 'identyfikacja', 'komisjonowanie', 'automatyzacja'],
        author: admin._id
      },
      {
        title: 'Planowanie czynno≈õci manipulacyjnych podczas prze≈Çadunku',
        excerpt: 'Efektywne zarzƒÖdzanie operacjami prze≈Çadunkowymi. Poznaj metody planowania, optymalizacji i koordynacji prac prze≈Çadunkowych.',
        contentHTML: '<h2>Planowanie operacji prze≈Çadunkowych</h2><p>Kompleksowy kurs zarzƒÖdzania operacjami prze≈Çadunkowymi. Nauczysz siƒô planowaƒá, koordynowaƒá i optymalizowaƒá procesy prze≈Çadunku w r√≥≈ºnych typach terminali.</p><h3>Operacje:</h3><ul><li>Planowanie prze≈Çadunk√≥w</li><li>Koordynacja zespo≈Ç√≥w roboczych</li><li>Optymalizacja czas√≥w operacji</li><li>ZarzƒÖdzanie zasobami sprzƒôtowymi</li><li>Bezpiecze≈Ñstwo prac prze≈Çadunkowych</li></ul>',
        imageUrl: './imgs/medium-shot-smiley-man-warehouse.jpg',
        weeks: 4,
        hours: 32,
        targetGroup: 'doro≈õli',
        maxParticipants: 22,
        
        status: 'published',
        tags: ['prze≈Çadunek', 'planowanie', 'koordynacja', 'terminale'],
        author: admin._id
      },
      {
        title: 'Transport przesy≈Çek z wykorzystaniem bezza≈Çogowego statku powietrznego',
        excerpt: 'Praktyczne wykorzystanie dron√≥w w dostawach. Poznaj procedury operacyjne, planowanie misji i zarzƒÖdzanie flotƒÖ dron√≥w dostawczych.',
        contentHTML: '<h2>Transport dronami - aspekty praktyczne</h2><p>Praktyczny kurs operacji transportowych z wykorzystaniem dron√≥w. Poznasz procedury planowania misji, zarzƒÖdzanie flotƒÖ BSP oraz aspekty ekonomiczne dostaw dronami.</p><h3>Operacje:</h3><ul><li>Planowanie misji BSP</li><li>ZarzƒÖdzanie flotƒÖ dron√≥w</li><li>Analiza ekonomiczna dostaw</li><li>Integracja z systemami logistycznymi</li><li>Monitoring i kontrola operacji</li></ul>',
        imageUrl: './imgs/white-truck-delivery-shipping-service-3d-rendering.jpg',
        weeks: 5,
        hours: 40,
        targetGroup: 'doro≈õli',
        maxParticipants: 16,
        
        status: 'published',
        tags: ['drony', 'dostawy', 'planowanie misji', 'flota'],
        author: admin._id
      },
      {
        title: 'Jƒôzyk angielski w spedycji',
        excerpt: 'Angielski specjalistyczny dla bran≈ºy TSL. Poznaj terminologiƒô, dokumentacjƒô i komunikacjƒô w jƒôzyku angielskim w miƒôdzynarodowej logistyce.',
        contentHTML: '<h2>Jƒôzyk angielski w spedycji</h2><p>Specjalistyczny kurs jƒôzyka angielskiego dla pracownik√≥w bran≈ºy TSL. Poznasz terminologiƒô spedycyjnƒÖ, dokumentacjƒô miƒôdzynarodowƒÖ oraz komunikacjƒô biznesowƒÖ w jƒôzyku angielskim.</p><h3>Zakres:</h3><ul><li>Terminologia spedycyjna po angielsku</li><li>Dokumentacja handlowa miƒôdzynarodowa</li><li>Korespondencja biznesowa</li><li>Negocjacje w j. angielskim</li><li>Komunikacja telefoniczna</li></ul>',
        imageUrl: './imgs/medium-shot-woman-with-tablet.jpg',
        weeks: 8,
        hours: 64,
        targetGroup: 'doro≈õli',
        maxParticipants: 15,
        
        status: 'published',
        tags: ['jƒôzyk angielski', 'terminologia', 'komunikacja', 'spedycja'],
        author: admin._id
      },
      {
        title: 'Jƒôzyk niemiecki w spedycji',
        excerpt: 'Niemiecki specjalistyczny dla logistyki. Naucz siƒô komunikacji z partnerami niemieckimi, terminologii i dokumentacji w jƒôzyku niemieckim.',
        contentHTML: '<h2>Jƒôzyk niemiecki w spedycji</h2><p>Kurs jƒôzyka niemieckiego dedykowany bran≈ºy logistycznej. Poznasz terminologiƒô spedycyjnƒÖ, dokumentacjƒô oraz skutecznƒÖ komunikacjƒô z partnerami niemieckimi w bran≈ºy TSL.</p><h3>Program:</h3><ul><li>Terminologia logistyczna po niemiecku</li><li>Dokumentacja spedycyjna</li><li>Komunikacja telefoniczna i mailowa</li><li>Kultura biznesowa niemiecka</li><li>Negocjacje z partnerami niemieckimi</li></ul>',
        imageUrl: './imgs/medium-shot-woman-storage.jpg',
        weeks: 8,
        hours: 64,
        targetGroup: 'doro≈õli',
        maxParticipants: 15,
        
        status: 'published',
        tags: ['jƒôzyk niemiecki', 'komunikacja', 'partnerzy', 'kultura biznesowa'],
        author: admin._id
      },
      {
        title: 'Bran≈ºowy jƒôzyk polski jako jƒôzyk obcy',
        excerpt: 'Polski jƒôzyk specjalistyczny dla cudzoziemc√≥w w TSL. Kurs dedykowany pracownikom zagranicznym w polskiej bran≈ºy transportowo-spedycyjnej.',
        contentHTML: '<h2>Polski jƒôzyk bran≈ºowy dla cudzoziemc√≥w</h2><p>Specjalistyczny kurs jƒôzyka polskiego dla pracownik√≥w zagranicznych w bran≈ºy TSL. Program obejmuje terminologiƒô bran≈ºowƒÖ, komunikacjƒô zawodowƒÖ oraz kulturƒô pracy w Polsce.</p><h3>Elementy:</h3><ul><li>Terminologia TSL po polsku</li><li>Komunikacja zawodowa w Polsce</li><li>Dokumentacja polska</li><li>Kultura pracy w Polsce</li><li>Procedury prawne w jƒôzyku polskim</li></ul>',
        imageUrl: './imgs/woman-safety-equipment-working.jpg',
        weeks: 10,
        hours: 80,
        targetGroup: 'doro≈õli',
        maxParticipants: 12,
        
        status: 'published',
        tags: ['jƒôzyk polski', 'cudzoziemcy', 'integracja', 'kultura pracy'],
        author: admin._id
      }
    ];

    for (const courseData of courses) {
      const course = new Course(courseData);
      await course.save();
      console.log(`‚úÖ Course created: ${course.title}`);
    }

    console.log(`üéì Successfully created ${courses.length} new courses`);

  } catch (error) {
    console.error('Error creating courses:', error);
  }
};

const main = async () => {
  console.log('üå± Starting database seeding...');
  
  await connectDB();
  await seedAdmin();
  
  if (process.env.NODE_ENV === 'development') {
    await seedSampleData();
  }
  
  // Always seed courses
  await seedCourses();
  
  console.log('‚úÖ Seeding completed!');
  process.exit(0);
};

main().catch(error => {
  console.error('Seeding failed:', error);
  process.exit(1);
});

