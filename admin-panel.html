<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administratora - BCU SPEDYCJA</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css">
    <style>
        :where([class^="ri-"])::before { content: "\f3c2"; }
        
        *:focus {
            outline: none !important;
        }
        
        button:focus, a:focus, input:focus, select:focus, textarea:focus {
            box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.4) !important;
            border-color: #3B82F6 !important;
        }
        
        .sidebar-transition {
            transition: transform 0.3s ease-in-out;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: #10B981;
        }
        
        .notification.error {
            background: #EF4444;
        }
        
        .notification.warning {
            background: #F59E0B;
        }

        /* Styles for Application Print Modal */
        .application-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }
        
        .application-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .application-content {
            background: white;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        /* Print Styles for A4 Format */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .application-print-content, .application-print-content * {
                visibility: visible;
            }
            
            .application-print-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                background: white;
                font-family: 'Arial', sans-serif;
                font-size: 12pt;
                line-height: 1.4;
                color: #000;
            }
            
            .print-header {
                border-bottom: 2px solid #E30613;
                padding-bottom: 15px;
                margin-bottom: 20px;
            }
            
            .print-logo {
                font-size: 24pt;
                font-weight: bold;
                color: #E30613;
                margin-bottom: 5px;
            }
            
            .print-subtitle {
                font-size: 14pt;
                color: #004080;
                margin-bottom: 10px;
            }
            
            .print-section {
                margin-bottom: 20px;
                break-inside: avoid;
            }
            
            .print-section-title {
                font-size: 14pt;
                font-weight: bold;
                color: #E30613;
                border-bottom: 1px solid #ccc;
                padding-bottom: 5px;
                margin-bottom: 10px;
            }
            
            .print-field {
                margin-bottom: 8px;
                display: flex;
                align-items: flex-start;
            }
            
            .print-field-label {
                font-weight: bold;
                width: 150px;
                flex-shrink: 0;
                color: #333;
            }
            
            .print-field-value {
                flex: 1;
                word-wrap: break-word;
            }
            
            .print-status {
                display: inline-block;
                padding: 4px 12px;
                border-radius: 20px;
                font-size: 10pt;
                font-weight: bold;
                text-transform: uppercase;
            }
            
            .print-status.new {
                background: #FEF3C7;
                color: #92400E;
                border: 1px solid #F59E0B;
            }
            
            .print-status.accepted {
                background: #D1FAE5;
                color: #065F46;
                border: 1px solid #10B981;
            }
            
            .print-status.rejected {
                background: #FEE2E2;
                color: #991B1B;
                border: 1px solid #EF4444;
            }
            
            .print-status.waiting {
                background: #E0E7FF;
                color: #3730A3;
                border: 1px solid #6366F1;
            }
            
            .print-footer {
                margin-top: 30px;
                padding-top: 15px;
                border-top: 1px solid #ccc;
                font-size: 10pt;
                color: #666;
                text-align: center;
            }
            
            .no-print {
                display: none !important;
            }
            
            @page {
                size: A4;
                margin: 2cm;
            }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#E30613',
                        'primary-dark': '#B8050F',
                        'primary-light': '#FF1A2B',
                        secondary: '#004080',
                        neutral: '#B3B3B3'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <button id="sidebar-toggle" class="p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary">
                        <i class="ri-menu-line text-xl"></i>
                    </button>
                    <div class="ml-4">
                        <h1 class="text-xl font-semibold text-gray-900">Panel Administratora</h1>
                        <p class="text-sm text-gray-500">BCU SPEDYCJA</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="flex items-center text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md hover:bg-gray-100" data-section="users" onclick="console.log('üëÜ Users button clicked'); window.adminPanel.showSection('users')">
                        <i class="ri-user-settings-line mr-2"></i>
                        <span class="hidden sm:inline">U≈ºytkownicy</span>
                    </button>
                    <a href="/" class="text-gray-500 hover:text-gray-700">
                        <i class="ri-home-line text-xl"></i>
                    </a>
                    <button id="logout-btn" class="text-gray-500 hover:text-gray-700">
                        <i class="ri-logout-box-line text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar-transition bg-white shadow-sm w-64 min-h-screen">
            <div class="p-4">
                <nav class="space-y-2">
                    <a href="#dashboard" class="nav-item flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-100" data-section="dashboard">
                        <i class="ri-dashboard-line mr-3"></i>
                        Dashboard
                    </a>
                    <a href="#news" class="nav-item flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-100" data-section="news">
                        <i class="ri-newspaper-line mr-3"></i>
                        Aktualno≈õci
                    </a>
                    <a href="#courses" class="nav-item flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-100" data-section="courses">
                        <i class="ri-book-line mr-3"></i>
                        Kursy
                    </a>
                    <a href="#applications" class="nav-item flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-100 ml-6" data-section="applications">
                        <i class="ri-user-follow-line mr-3"></i>
                        Aplikacje
                    </a>
                    <a href="#jobs" class="nav-item flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-100" data-section="jobs">
                        <i class="ri-briefcase-line mr-3"></i>
                        Oferty Pracy
                    </a>
                    <a href="#job-applications" class="nav-item flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-100 ml-6" data-section="job-applications">
                        <i class="ri-user-follow-line mr-3"></i>
                        Aplikacje
                    </a>
                    <a href="#materials" class="nav-item flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-100" data-section="materials">
                        <i class="ri-folder-download-line mr-3"></i>
                        Repozytorium materia≈Ç√≥w
                    </a>
                    <a href="#applications" class="nav-item flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-100" data-section="applications">
                        <i class="ri-file-user-line mr-3"></i>
                        Zg≈Çoszenia na kursy
                    </a>
                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-6">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="section">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Dashboard</h2>
                    <p class="text-gray-600">PrzeglƒÖd wszystkich tre≈õci na stronie</p>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-2 bg-blue-100 rounded-lg">
                                <i class="ri-newspaper-line text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Aktualno≈õci</p>
                                <p class="text-2xl font-bold text-gray-900" id="news-count">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-2 bg-green-100 rounded-lg">
                                <i class="ri-book-line text-green-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Kursy</p>
                                <p class="text-2xl font-bold text-gray-900" id="courses-count">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-2 bg-purple-100 rounded-lg">
                                <i class="ri-briefcase-line text-purple-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Oferty Pracy</p>
                                <p class="text-2xl font-bold text-gray-900" id="jobs-count">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="p-2 bg-orange-100 rounded-lg">
                                <i class="ri-eye-line text-orange-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Opublikowane</p>
                                <p class="text-2xl font-bold text-gray-900" id="published-count">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Ostatnia aktywno≈õƒá</h3>
                    </div>
                    <div class="p-6">
                        <div id="recent-activity" class="space-y-4">
                            <div class="flex items-center text-gray-500">
                                <i class="ri-loader-4-line animate-spin mr-3"></i>
                                ≈Åadowanie...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- News Section -->
            <div id="news-section" class="section hidden">
                <div class="mb-6 flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Aktualno≈õci</h2>
                        <p class="text-gray-600">ZarzƒÖdzaj aktualno≈õciami i newsami</p>
                    </div>
                    <button id="add-news-btn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors">
                        <i class="ri-add-line mr-2"></i>Dodaj aktualno≈õƒá
                    </button>
                </div>

                <!-- News List -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-medium text-gray-900">Lista aktualno≈õci</h3>
                            <div class="flex space-x-2">
                                <select id="news-status-filter" class="border border-gray-300 rounded-md px-3 py-1 text-sm">
                                    <option value="">Wszystkie</option>
                                    <option value="published">Opublikowane</option>
                                    <option value="draft">Szkice</option>
                                    <option value="archived">Zarchiwizowane</option>
                                </select>
                                <button id="refresh-news-btn" class="text-gray-500 hover:text-gray-700">
                                    <i class="ri-refresh-line text-xl"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div id="news-list" class="space-y-4">
                            <div class="flex items-center justify-center py-8 text-gray-500">
                                <i class="ri-loader-4-line animate-spin mr-3"></i>
                                ≈Åadowanie aktualno≈õci...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Courses Section -->
            <div id="courses-section" class="section hidden">
                <div class="mb-6 flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Kursy</h2>
                        <p class="text-gray-600">ZarzƒÖdzaj kursami i szkoleniami</p>
                    </div>
                    <button id="add-course-btn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors">
                        <i class="ri-add-line mr-2"></i>Dodaj kurs
                    </button>
                </div>

                <!-- Courses List -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-medium text-gray-900">Lista kurs√≥w</h3>
                            <div class="flex space-x-2">
                                <select id="courses-view-mode" class="border border-gray-300 rounded-md px-3 py-1 text-sm">
                                    <option value="list">Lista kurs√≥w</option>
                                    <option value="grouped">Grupowanie po nazwie</option>
                                </select>
                                <select id="courses-status-filter" class="border border-gray-300 rounded-md px-3 py-1 text-sm">
                                    <option value="">Wszystkie</option>
                                    <option value="published">Opublikowane</option>
                                    <option value="draft">Szkice</option>
                                    <option value="archived">Zarchiwizowane</option>
                                </select>
                                <button id="refresh-courses-btn" class="text-gray-500 hover:text-gray-700">
                                    <i class="ri-refresh-line text-xl"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div id="courses-list" class="space-y-4">
                            <div class="flex items-center justify-center py-8 text-gray-500">
                                <i class="ri-loader-4-line animate-spin mr-3"></i>
                                ≈Åadowanie kurs√≥w...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Jobs Section -->
            <div id="jobs-section" class="section hidden">
                <div class="mb-6 flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Oferty Pracy</h2>
                        <p class="text-gray-600">ZarzƒÖdzaj ofertami pracy i praktyk</p>
                    </div>
                    <button id="add-job-btn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors">
                        <i class="ri-add-line mr-2"></i>Dodaj ofertƒô
                    </button>
                </div>

                <!-- Jobs List -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-medium text-gray-900">Lista ofert pracy</h3>
                            <div class="flex space-x-2">
                                <select id="jobs-status-filter" class="border border-gray-300 rounded-md px-3 py-1 text-sm">
                                    <option value="">Wszystkie</option>
                                    <option value="published">Opublikowane</option>
                                    <option value="draft">Szkice</option>
                                    <option value="archived">Zarchiwizowane</option>
                                </select>
                                <button id="refresh-jobs-btn" class="text-gray-500 hover:text-gray-700">
                                    <i class="ri-refresh-line text-xl"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div id="jobs-list" class="space-y-4">
                            <div class="flex items-center justify-center py-8 text-gray-500">
                                <i class="ri-loader-4-line animate-spin mr-3"></i>
                                ≈Åadowanie ofert pracy...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Materials Section -->
            <div id="materials-section" class="section hidden">
                <div class="mb-6 flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Repozytorium materia≈Ç√≥w edukacyjnych</h2>
                        <p class="text-gray-600">ZarzƒÖdzaj materia≈Çami edukacyjnymi - dokumenty, prezentacje, filmy i inne zasoby</p>
                    </div>
                    <button id="add-material-btn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors">
                        <i class="ri-add-line mr-2"></i>
                        Dodaj materia≈Ç
                    </button>
                    <button onclick="testMaterialUpload()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        <i class="ri-bug-line mr-2"></i>
                        Test Upload
                    </button>
                </div>

                <!-- Materials List -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-medium text-gray-900">Lista materia≈Ç√≥w</h3>
                            <div class="flex space-x-2">
                                <select id="materials-type-filter" class="border border-gray-300 rounded-md px-3 py-1 text-sm">
                                    <option value="">Wszystkie typy</option>
                                    <option value="document">Dokumenty</option>
                                    <option value="video">Filmy</option>
                                    <option value="presentation">Prezentacje</option>
                                    <option value="exercise">ƒÜwiczenia</option>
                                    <option value="test">Testy</option>
                                    <option value="link">Linki</option>
                                </select>
                                <select id="materials-level-filter" class="border border-gray-300 rounded-md px-3 py-1 text-sm">
                                    <option value="">Wszystkie poziomy</option>
                                    <option value="beginner">PoczƒÖtkujƒÖcy</option>
                                    <option value="intermediate">≈öredniozaawansowany</option>
                                    <option value="advanced">Zaawansowany</option>
                                </select>
                                <select id="materials-public-filter" class="border border-gray-300 rounded-md px-3 py-1 text-sm">
                                    <option value="">Wszystkie</option>
                                    <option value="true">Publiczne</option>
                                    <option value="false">Prywatne</option>
                                </select>
                                <button id="refresh-materials-btn" class="text-gray-500 hover:text-gray-700">
                                    <i class="ri-refresh-line text-xl"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div id="materials-list" class="space-y-4">
                            <div class="flex items-center justify-center py-8 text-gray-500">
                                <i class="ri-loader-4-line animate-spin mr-3"></i>
                                ≈Åadowanie materia≈Ç√≥w...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Job Applications Section -->
            <div id="job-applications-section" class="section hidden">
                <div class="mb-6 flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Aplikacje do ofert pracy</h2>
                        <p class="text-gray-600">ZarzƒÖdzaj aplikacjami kandydat√≥w do ofert pracy</p>
                    </div>
                </div>

                <!-- Job Applications List -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-medium text-gray-900">Aplikacje pogrupowane wed≈Çug ofert pracy</h3>
                            <div class="flex space-x-2">
                                <select id="job-applications-status-filter" class="border border-gray-300 rounded-md px-3 py-1 text-sm">
                                    <option value="">Wszystkie</option>
                                    <option value="new">Nowe</option>
                                    <option value="accepted">Zaakceptowane</option>
                                    <option value="rejected">Odrzucone</option>
                                    <option value="waiting">OczekujƒÖce</option>
                                </select>
                                <button id="refresh-job-applications-btn" class="text-gray-500 hover:text-gray-700">
                                    <i class="ri-refresh-line text-xl"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div id="job-applications-list" class="space-y-4">
                            <div class="flex items-center justify-center py-8 text-gray-500">
                                <i class="ri-loader-4-line animate-spin mr-3"></i>
                                ≈Åadowanie aplikacji...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Applications Section -->
            <div id="applications-section" class="section hidden">
                <div class="mb-6 flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Zg≈Çoszenia na kursy</h2>
                        <p class="text-gray-600">ZarzƒÖdzaj aplikacjami uczestnik√≥w na kursy</p>
                    </div>
                </div>

                <!-- Applications List -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-medium text-gray-900">Zg≈Çoszenia pogrupowane wed≈Çug kurs√≥w</h3>
                            <div class="flex space-x-2">
                                <select id="applications-status-filter" class="border border-gray-300 rounded-md px-3 py-1 text-sm">
                                    <option value="">Wszystkie</option>
                                    <option value="new">Nowe</option>
                                    <option value="accepted">Zaakceptowane</option>
                                    <option value="rejected">Odrzucone</option>
                                    <option value="waiting">OczekujƒÖce</option>
                                </select>
                                <button id="refresh-applications-btn" class="text-gray-500 hover:text-gray-700">
                                    <i class="ri-refresh-line text-xl"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div id="applications-list" class="space-y-4">
                            <div class="flex items-center justify-center py-8 text-gray-500">
                                <i class="ri-loader-4-line animate-spin mr-3"></i>
                                ≈Åadowanie zg≈Çosze≈Ñ...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Users Section -->
            <div id="users-section" class="section hidden">
                <div class="mb-6 flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">ZarzƒÖdzanie u≈ºytkownikami</h2>
                        <p class="text-gray-600">Zatwierdzaj, usuwaj i nadawaj role u≈ºytkownikom</p>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="testUsersAPI()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            <i class="ri-bug-line mr-2"></i>
                            Test API
                        </button>
                        <button onclick="window.adminPanel.loadUsers()" class="bg-secondary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="ri-refresh-line mr-2"></i>
                            Od≈õwie≈º
                        </button>
                    </div>
                </div>

                <!-- Users List -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-medium text-gray-900">Lista u≈ºytkownik√≥w</h3>
                            <div class="flex space-x-2">
                                <select id="users-role-filter" class="border border-gray-300 rounded-md px-3 py-1 text-sm">
                                    <option value="">Wszystkie role</option>
                                    <option value="admin">Administrator</option>
                                    <option value="wykladowca">Wyk≈Çadowca</option>
                                    <option value="redaktor">Redaktor</option>
                                    <option value="pracodawca">Pracodawca</option>
                                    <option value="kursant">Kursant</option>
                                </select>
                                <select id="users-status-filter" class="border border-gray-300 rounded-md px-3 py-1 text-sm">
                                    <option value="">Wszystkie statusy</option>
                                    <option value="true">Aktywni</option>
                                    <option value="false">Nieaktywni</option>
                                </select>
                                <button id="refresh-users-btn" class="text-gray-500 hover:text-gray-700">
                                    <i class="ri-refresh-line text-xl"></i>
                                </button>
                                <button onclick="testUsersAPI()" class="px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600">
                                    Test API
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6">
                        <div id="users-list" class="space-y-4">
                            <div class="flex items-center justify-center py-8 text-gray-500">
                                <i class="ri-loader-4-line animate-spin mr-3"></i>
                                ≈Åadowanie u≈ºytkownik√≥w...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Edit Modal -->
    <div id="user-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-md w-full">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-semibold text-gray-900" id="user-modal-title">Edytuj u≈ºytkownika</h3>
                    <button onclick="hideUserModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="ri-close-line text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <form id="user-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Rola</label>
                        <select name="role" id="user-role" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary">
                            <option value="kursant">Kursant</option>
                            <option value="wykladowca">Wyk≈Çadowca</option>
                            <option value="redaktor">Redaktor</option>
                            <option value="pracodawca">Pracodawca</option>
                            <option value="admin">Administrator</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-3">
                        <label class="flex items-center">
                            <input type="checkbox" name="isActive" id="user-active" class="rounded border-gray-300 text-primary focus:ring-primary">
                            <span class="ml-2 text-sm text-gray-700">Konto aktywne</span>
                        </label>
                    </div>
                    <div class="flex items-center space-x-3">
                        <label class="flex items-center">
                            <input type="checkbox" name="isVerified" id="user-verified" class="rounded border-gray-300 text-primary focus:ring-primary">
                            <span class="ml-2 text-sm text-gray-700">Email zweryfikowany</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="p-6 border-t border-gray-200 flex justify-end space-x-3">
                <button type="button" onclick="hideUserModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                    Anuluj
                </button>
                <button type="button" onclick="saveUser()" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark">
                    Zapisz
                </button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        class AdminPanel {
            constructor() {
                this.currentSection = 'dashboard';
                this.news = [];
                this.courses = [];
                this.jobs = [];
                this.applications = [];
                this.courseGroups = [];
                this.applicationGroups = [];
                this.jobApplicationGroups = [];
                this.materials = [];
                this.users = [];
                this.currentUser = null;
                this.escapeListenerAdded = false;
                this.init();
            }

            async init() {
                // Check authentication first
                const isAuthenticated = await this.checkAuth();
                if (!isAuthenticated) {
                    window.location.href = '/admin-login.html';
                    return;
                }
                
                this.bindEvents();
                this.loadDashboard();
                
                // Check for hash in URL
                const hash = window.location.hash.substring(1);
                if (hash && ['dashboard', 'news', 'courses', 'jobs', 'job-applications', 'materials', 'applications', 'users'].includes(hash)) {
                    this.showSection(hash);
                } else {
                    this.showSection('dashboard');
                }
            }

            async checkAuth() {
                try {
                    const response = await fetch('/api/auth/status', { 
                        credentials: 'include' 
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        this.currentUser = data.user;
                        return true;
                    } else {
                        return false;
                    }
                } catch (error) {
                    console.error('Auth check error:', error);
                    return false;
                }
            }

            bindEvents() {
                // Sidebar toggle
                document.getElementById('sidebar-toggle').addEventListener('click', () => {
                    const sidebar = document.getElementById('sidebar');
                    sidebar.classList.toggle('-translate-x-full');
                });

                // Navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = item.dataset.section;
                        this.showSection(section);
                    });
                });

                // Add buttons
                document.getElementById('add-news-btn').addEventListener('click', () => this.showNewsModal());
                document.getElementById('add-course-btn').addEventListener('click', () => this.showCourseModal());
                document.getElementById('add-job-btn').addEventListener('click', () => this.showJobModal());

                // Refresh buttons
                document.getElementById('refresh-news-btn').addEventListener('click', () => this.loadNews());
                document.getElementById('refresh-courses-btn').addEventListener('click', () => this.loadCourses());
                document.getElementById('refresh-jobs-btn').addEventListener('click', () => this.loadJobs());
                document.getElementById('refresh-applications-btn').addEventListener('click', () => this.loadApplications());
                document.getElementById('refresh-job-applications-btn').addEventListener('click', () => this.loadJobApplications());
                document.getElementById('refresh-materials-btn').addEventListener('click', () => this.loadMaterials());
                document.getElementById('add-material-btn').addEventListener('click', () => this.showMaterialModal());
                document.getElementById('refresh-users-btn').addEventListener('click', () => this.loadUsers());

                // Filters
                document.getElementById('news-status-filter').addEventListener('change', () => this.filterNews());
                document.getElementById('courses-status-filter').addEventListener('change', () => this.filterCourses());
                document.getElementById('courses-view-mode').addEventListener('change', () => this.handleViewModeChange());
                document.getElementById('jobs-status-filter').addEventListener('change', () => this.filterJobs());
                document.getElementById('materials-type-filter').addEventListener('change', () => this.filterMaterials());
                document.getElementById('materials-level-filter').addEventListener('change', () => this.filterMaterials());
                document.getElementById('materials-public-filter').addEventListener('change', () => this.filterMaterials());
                document.getElementById('users-role-filter').addEventListener('change', () => this.filterUsers());
                document.getElementById('users-status-filter').addEventListener('change', () => this.filterUsers());

                // Logout
                document.getElementById('logout-btn').addEventListener('click', () => this.logout());
            }

            showSection(section) {
                console.log('üîÑ Switching to section:', section);
                // Hide all sections
                document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
                
                // Show selected section
                const sectionElement = document.getElementById(`${section}-section`);
                console.log('üéØ Target section element:', sectionElement);
                if (sectionElement) {
                    sectionElement.classList.remove('hidden');
                } else {
                    console.error('‚ùå Section element not found:', `${section}-section`);
                }
                
                // Update navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('bg-gray-100', 'text-primary');
                    item.classList.add('text-gray-700');
                });
                
                document.querySelector(`[data-section="${section}"]`).classList.add('bg-gray-100', 'text-primary');
                document.querySelector(`[data-section="${section}"]`).classList.remove('text-gray-700');
                
                // Update URL hash
                window.location.hash = section;
                
                this.currentSection = section;
                
                // Load section data
                switch(section) {
                    case 'dashboard':
                        this.loadDashboard();
                        break;
                    case 'news':
                        this.loadNews();
                        break;
                    case 'courses':
                        this.loadCourses();
                        break;
                    case 'jobs':
                        this.loadJobs();
                        break;
                    case 'applications':
                        this.loadApplications();
                        break;
                    case 'job-applications':
                        this.loadJobApplications();
                        break;
                    case 'materials':
                        this.loadMaterials();
                        break;
                    case 'users':
                        console.log('üîÑ Loading users section...');
                        this.checkUserPermissions().then(() => {
                            this.loadUsers();
                        });
                        break;
                }
            }

            async loadDashboard() {
                try {
                    // Load stats
                    const [newsRes, coursesRes, jobsRes] = await Promise.all([
                        fetch('/api/news/admin/list', { credentials: 'include' }),
                        fetch('/api/courses/admin/list', { credentials: 'include' }),
                        fetch('/api/job-offers/admin/list', { credentials: 'include' })
                    ]);

                    const newsData = await newsRes.json();
                    const coursesData = await coursesRes.json();
                    const jobsData = await jobsRes.json();

                    document.getElementById('news-count').textContent = newsData.news?.length || 0;
                    document.getElementById('courses-count').textContent = coursesData.courses?.length || 0;
                    document.getElementById('jobs-count').textContent = jobsData.jobOffers?.length || 0;

                    const publishedCount = (newsData.news?.filter(n => n.status === 'published').length || 0) +
                                         (coursesData.courses?.filter(c => c.status === 'published').length || 0) +
                                         (jobsData.jobOffers?.filter(j => j.status === 'published').length || 0);
                    document.getElementById('published-count').textContent = publishedCount;

                    // Load recent activity
                    this.loadRecentActivity(newsData.news, coursesData.courses, jobsData.jobOffers);
                } catch (error) {
                    console.error('Error loading dashboard:', error);
                    this.showNotification('B≈ÇƒÖd ≈Çadowania dashboardu', 'error');
                }
            }

            loadRecentActivity(news, courses, jobs) {
                const activity = [];
                
                // Add recent news
                if (news) {
                    news.slice(0, 3).forEach(item => {
                        activity.push({
                            type: 'news',
                            title: item.title,
                            date: new Date(item.updatedAt || item.createdAt),
                            status: item.status
                        });
                    });
                }

                // Add recent courses
                if (courses) {
                    courses.slice(0, 3).forEach(item => {
                        activity.push({
                            type: 'course',
                            title: item.title,
                            date: new Date(item.updatedAt || item.createdAt),
                            status: item.status
                        });
                    });
                }

                // Add recent jobs
                if (jobs) {
                    jobs.slice(0, 3).forEach(item => {
                        activity.push({
                            type: 'job',
                            title: item.title,
                            date: new Date(item.updatedAt || item.createdAt),
                            status: item.status
                        });
                    });
                }

                // Sort by date
                activity.sort((a, b) => b.date - a.date);

                // Render
                const container = document.getElementById('recent-activity');
                if (activity.length === 0) {
                    container.innerHTML = '<div class="text-gray-500 text-center py-4">Brak ostatniej aktywno≈õci</div>';
                    return;
                }

                container.innerHTML = activity.slice(0, 10).map(item => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center">
                            <div class="p-2 bg-white rounded-lg mr-3">
                                <i class="ri-${item.type === 'news' ? 'newspaper' : item.type === 'course' ? 'book' : 'briefcase'}-line text-gray-600"></i>
                            </div>
                            <div>
                                <p class="font-medium text-gray-900">${item.title}</p>
                                <p class="text-sm text-gray-500">${item.type === 'news' ? 'Aktualno≈õƒá' : item.type === 'course' ? 'Kurs' : 'Oferta pracy'}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                item.status === 'published' ? 'bg-green-100 text-green-800' :
                                item.status === 'draft' ? 'bg-yellow-100 text-yellow-800' :
                                'bg-gray-100 text-gray-800'
                            }">
                                ${item.status === 'published' ? 'Opublikowane' : item.status === 'draft' ? 'Szkic' : 'Zarchiwizowane'}
                            </span>
                            <p class="text-sm text-gray-500 mt-1">${item.date.toLocaleDateString('pl-PL')}</p>
                        </div>
                    </div>
                `).join('');
            }

            async loadNews() {
                try {
                    const response = await fetch('/api/news/admin/list', { credentials: 'include' });
                    const data = await response.json();
                    
                    if (data.success) {
                        this.news = data.news || [];
                        this.renderNews();
                        this.addEventListeners();
                    } else {
                        throw new Error(data.message || 'B≈ÇƒÖd ≈Çadowania aktualno≈õci');
                    }
                } catch (error) {
                    console.error('Error loading news:', error);
                    this.showNotification('B≈ÇƒÖd ≈Çadowania aktualno≈õci: ' + error.message, 'error');
                }
            }

            renderNews() {
                const container = document.getElementById('news-list');
                
                if (this.news.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i class="ri-newspaper-line text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 mb-4">Brak aktualno≈õci</p>
                            <button data-action="add-news" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors">
                                Dodaj pierwszƒÖ aktualno≈õƒá
                            </button>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.news.map(news => `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h4 class="font-medium text-gray-900 mb-2">${news.title}</h4>
                                <p class="text-sm text-gray-600 mb-3">${news.excerpt || 'Brak opisu...'}</p>
                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                    <span><i class="ri-calendar-line mr-1"></i>${new Date(news.publishedAt || news.createdAt).toLocaleDateString('pl-PL')}</span>
                                    <span><i class="ri-user-line mr-1"></i>${news.author ? (news.author.firstName + ' ' + news.author.lastName) : 'Admin'}</span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2 ml-4">
                                <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                    news.isActive === false ? 'bg-red-100 text-red-800' :
                                    news.status === 'published' ? 'bg-green-100 text-green-800' :
                                    news.status === 'draft' ? 'bg-yellow-100 text-yellow-800' :
                                    'bg-gray-100 text-gray-800'
                                }">
                                    ${news.isActive === false ? 'Nieaktywny' : 
                                      news.status === 'published' ? 'Opublikowany' : 
                                      news.status === 'draft' ? 'Szkic' : 'Zarchiwizowany'}
                                </span>
                                <button data-action="edit-news" data-id="${news._id}" class="text-blue-600 hover:text-blue-800">
                                    <i class="ri-edit-line"></i>
                                </button>
                                <button data-action="delete-news" data-id="${news._id}" class="text-red-600 hover:text-red-800">
                                    <i class="ri-delete-bin-line"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type}`;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 5000);
            }

            async loadCourses() {
                try {
                    const response = await fetch('/api/courses/admin/list', { credentials: 'include' });
                    const data = await response.json();
                    
                    if (data.success) {
                        this.courses = data.courses || [];
                        this.renderCourses();
                        this.addEventListeners();
                    } else {
                        throw new Error(data.message || 'B≈ÇƒÖd ≈Çadowania kurs√≥w');
                    }
                } catch (error) {
                    console.error('Error loading courses:', error);
                    this.showNotification('B≈ÇƒÖd ≈Çadowania kurs√≥w: ' + error.message, 'error');
                }
            }

            renderCourses() {
                const container = document.getElementById('courses-list');
                
                if (this.courses.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i class="ri-book-line text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 mb-4">Brak kurs√≥w</p>
                            <button data-action="add-course" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors">
                                Dodaj pierwszy kurs
                            </button>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.courses.map(course => `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h4 class="font-medium text-gray-900 mb-2">${course.title}</h4>
                                <p class="text-sm text-gray-600 mb-3">${course.excerpt || 'Brak opisu...'}</p>
                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                    <span><i class="ri-time-line mr-1"></i>${course.duration || 'Brak informacji'}</span>
                                    <span><i class="ri-timer-line mr-1"></i>${course.hours || 30}h</span>
                                    <span><i class="ri-group-line mr-1"></i>${course.targetGroup || 'doro≈õli'}</span>
                                    <span><i class="ri-user-line mr-1"></i>Max: ${course.maxParticipants || 20}</span>
                                </div>
                                <div class="flex items-center space-x-2 mt-2">
                                    <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                        course.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                    }">
                                        ${course.isActive ? 'Aktywny' : 'Nieaktywny'}
                                    </span>
                                    <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                        course.isPaid ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800'
                                    }">
                                        ${course.isPaid ? 'P≈Çatny' : 'Bezp≈Çatny'}
                                    </span>
                                    ${course.isPaid && course.price > 0 ? `<span class="text-xs text-gray-600">${course.price} PLN</span>` : ''}
                                </div>
                            </div>
                            <div class="flex items-center space-x-2 ml-4">
                                <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                    course.isActive === false ? 'bg-red-100 text-red-800' :
                                    course.status === 'published' ? 'bg-green-100 text-green-800' :
                                    course.status === 'draft' ? 'bg-yellow-100 text-yellow-800' :
                                    'bg-gray-100 text-gray-800'
                                }">
                                    ${course.isActive === false ? 'Nieaktywny' : 
                                      course.status === 'published' ? 'Opublikowany' : 
                                      course.status === 'draft' ? 'Szkic' : 'Zarchiwizowany'}
                                </span>
                                <button data-action="preview-course" data-id="${course._id}" class="text-blue-600 hover:text-blue-800" title="PodglƒÖd">
                                    <i class="ri-eye-line"></i>
                                </button>
                                <button data-action="edit-course" data-id="${course._id}" class="text-blue-600 hover:text-blue-800" title="Edytuj">
                                    <i class="ri-edit-line"></i>
                                </button>
                                <button data-action="delete-course" data-id="${course._id}" class="text-red-600 hover:text-red-800" title="Usu≈Ñ">
                                    <i class="ri-delete-bin-line"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            async loadJobs() {
                try {
                    const response = await fetch('/api/job-offers/admin/list', { credentials: 'include' });
                    const data = await response.json();
                    
                    if (data.success) {
                        this.jobs = data.jobOffers || [];
                        this.renderJobs();
                        this.addEventListeners();
                    } else {
                        throw new Error(data.message || 'B≈ÇƒÖd ≈Çadowania ofert pracy');
                    }
                } catch (error) {
                    console.error('Error loading jobs:', error);
                    this.showNotification('B≈ÇƒÖd ≈Çadowania ofert pracy: ' + error.message, 'error');
                }
            }

            renderJobs() {
                const container = document.getElementById('jobs-list');
                
                if (this.jobs.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i class="ri-briefcase-line text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 mb-4">Brak ofert pracy</p>
                            <button data-action="add-job" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors">
                                Dodaj pierwszƒÖ ofertƒô
                            </button>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.jobs.map(job => `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h4 class="font-medium text-gray-900 mb-2">${job.title}</h4>
                                <p class="text-sm text-gray-600 mb-3">${job.companyName}</p>
                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                    <span><i class="ri-map-pin-line mr-1"></i>${job.location}</span>
                                    <span><i class="ri-calendar-line mr-1"></i>Wygasa: ${job.expireAt ? new Date(job.expireAt).toLocaleDateString('pl-PL') : 'Brak daty'}</span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2 ml-4">
                                <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                    job.isActive === false ? 'bg-red-100 text-red-800' :
                                    job.status === 'published' ? 'bg-green-100 text-green-800' :
                                    job.status === 'draft' ? 'bg-yellow-100 text-yellow-800' :
                                    'bg-gray-100 text-gray-800'
                                }">
                                    ${job.isActive === false ? 'Nieaktywny' : 
                                      job.status === 'published' ? 'Opublikowany' : 
                                      job.status === 'draft' ? 'Szkic' : 'Zarchiwizowany'}
                                </span>
                                <button data-action="edit-job" data-id="${job._id}" class="text-blue-600 hover:text-blue-800">
                                    <i class="ri-edit-line"></i>
                                </button>
                                <button data-action="delete-job" data-id="${job._id}" class="text-red-600 hover:text-red-800">
                                    <i class="ri-delete-bin-line"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            showNewsModal(newsId = null) {
                // Create modal for news
                this.createModal('news', newsId);
            }

            showCourseModal(courseId = null) {
                // Create modal for course
                this.createModal('course', courseId);
            }

            showJobModal(jobId = null) {
                // Create modal for job
                this.createModal('job', jobId);
            }

            createModal(type, id = null) {
                // Remove existing modal
                const existingModal = document.getElementById('content-modal');
                if (existingModal) {
                    existingModal.remove();
                }

                const modal = document.createElement('div');
                modal.id = 'content-modal';
                modal.className = 'modal show';
                
                const isEdit = id !== null;
                const title = isEdit ? `Edytuj ${type === 'news' ? 'aktualno≈õƒá' : type === 'course' ? 'kurs' : type === 'material' ? 'materia≈Ç' : 'ofertƒô pracy'}` : `Dodaj ${type === 'news' ? 'aktualno≈õƒá' : type === 'course' ? 'kurs' : type === 'material' ? 'materia≈Ç' : 'ofertƒô pracy'}`;
                
                modal.innerHTML = `
                    <div class="modal-content w-full max-w-4xl mx-4">
                        <div class="p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-xl font-semibold text-gray-900">${title}</h3>
                                <button data-action="close-modal" class="text-gray-400 hover:text-gray-600">
                                    <i class="ri-close-line text-xl"></i>
                                </button>
                            </div>
                            
                            <form id="${type}-form" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Tytu≈Ç *</label>
                                        <input type="text" name="title" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary">
                                    </div>
                                    ${type === 'news' ? `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                        <select name="status" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary">
                                            <option value="draft">Szkic</option>
                                            <option value="published">Opublikowane</option>
                                            <option value="archived">Zarchiwizowane</option>
                                        </select>
                                    </div>
                                    <div class="flex items-center">
                                        <label class="flex items-center">
                                            <input type="checkbox" name="isActive" checked class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary">
                                            <span class="ml-2 text-sm text-gray-700">Aktualno≈õƒá aktywna</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Zdjƒôcie</label>
                                        <div class="space-y-3">
                                            <input type="file" id="news-image-upload" accept="image/*" class="hidden">
                                            <input type="hidden" name="imageUrl" id="news-image-url">
                                            
                                            <div class="flex space-x-3">
                                                <button type="button" data-action="upload-news-image" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                                                    <i class="ri-upload-2-line mr-2"></i>
                                                    Wgraj zdjƒôcie
                                                </button>
                                                <button type="button" data-action="remove-news-image" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors hidden">
                                                    <i class="ri-delete-bin-line mr-2"></i>
                                                    Usu≈Ñ zdjƒôcie
                                                </button>
                                            </div>
                                            
                                            <div id="news-image-preview" class="hidden">
                                                <img id="news-preview-img" src="" alt="PodglƒÖd" class="w-32 h-24 object-cover rounded border">
                                                <div id="news-upload-progress" class="hidden mt-2">
                                                    <div class="bg-gray-200 rounded-full h-2">
                                                        <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                                    </div>
                                                    <p class="text-sm text-gray-600 mt-1">Przesy≈Çanie...</p>
                                                </div>
                                            </div>
                                            
                                            <p class="text-xs text-gray-500">Maksymalny rozmiar: 5MB. Obs≈Çugiwane formaty: JPG, PNG, GIF</p>
                                        </div>
                                    </div>
                                    ` : type === 'material' ? `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Typ materia≈Çu *</label>
                                        <select name="type" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary">
                                            <option value="document">Dokument</option>
                                            <option value="video">Film</option>
                                            <option value="presentation">Prezentacja</option>
                                            <option value="exercise">ƒÜwiczenie</option>
                                            <option value="test">Test</option>
                                            <option value="link">Link</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">URL pliku *</label>
                                        <div class="space-y-3">
                                            <input type="url" name="fileUrl" required placeholder="https://example.com/file.pdf" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary">
                                            <div class="flex space-x-3">
                                                <input type="file" id="material-file-upload" accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.zip,.rar" class="hidden">
                                                <button type="button" data-action="upload-material-file" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                                                    <i class="ri-upload-2-line mr-2"></i>
                                                    Wgraj plik
                                                </button>
                                            </div>
                                            <div id="material-upload-progress" class="hidden">
                                                <div class="bg-gray-200 rounded-full h-2">
                                                    <div class="bg-green-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                                </div>
                                                <p class="text-sm text-gray-600 mt-1">Przesy≈Çanie pliku...</p>
                                            </div>
                                            <p class="text-xs text-gray-500">Mo≈ºesz podaƒá bezpo≈õredni URL do pliku lub wgraƒá plik z komputera</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" name="isPublic" class="w-5 h-5 text-primary border-gray-300 rounded focus:ring-primary focus:ring-2">
                                            <span class="ml-3 text-base font-medium text-gray-800">Materia≈Ç publiczny</span>
                                        </label>
                                        <div class="ml-auto">
                                            <i class="ri-global-line text-blue-600 text-xl"></i>
                                        </div>
                                    </div>
                                    ` : type === 'course' ? `
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Liczba godzin *</label>
                                            <input type="number" name="hours" required min="1" placeholder="np. 30" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Max uczestnik√≥w *</label>
                                        <input type="number" name="maxParticipants" required min="1" placeholder="np. 20" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Grupa docelowa *</label>
                                        <select name="targetGroup" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary">
                                            <option value="uczniowie i studenci">Uczniowie i studenci</option>
                                            <option value="nauczyciele">Nauczyciele</option>
                                            <option value="doro≈õli" selected>Doro≈õli</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Status kursu</label>
                                        <select name="status" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary">
                                            <option value="draft">Szkic</option>
                                            <option value="published">Opublikowane</option>
                                            <option value="archived">Zarchiwizowane</option>
                                        </select>
                                    </div>
                                    <div class="flex items-center space-x-6">
                                        <label class="flex items-center">
                                            <input type="checkbox" name="isActive" checked class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary">
                                            <span class="ml-2 text-sm text-gray-700">Kurs aktywny</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" name="isPaid" class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary">
                                            <span class="ml-2 text-sm text-gray-700">Kurs p≈Çatny</span>
                                        </label>
                                    </div>
                                    <div id="price-field" class="hidden">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Cena (PLN)</label>
                                        <input type="number" name="price" min="0" placeholder="0" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary">
                                    </div>
                                    ` : `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Nazwa firmy *</label>
                                        <input type="text" name="companyName" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Lokalizacja *</label>
                                        <input type="text" name="location" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary">
                                    </div>
                                    <div class="flex items-center">
                                        <label class="flex items-center">
                                            <input type="checkbox" name="isActive" checked class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary">
                                            <span class="ml-2 text-sm text-gray-700">Oferta aktywna</span>
                                        </label>
                                    </div>
                                    `}
                                </div>
                                
                                ${type === 'material' ? `
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Opis</label>
                                    <textarea name="description" rows="4" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary" placeholder="Opcjonalny opis materia≈Çu..."></textarea>
                                </div>
                                ` : `
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Kr√≥tki opis (excerpt) *</label>
                                    <div class="border border-gray-300 rounded-md overflow-hidden">
                                        <div class="bg-gray-50 border-b border-gray-300 px-3 py-2 flex space-x-2">
                                            <button type="button" data-action="format-bold" data-target="excerpt" class="px-2 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100" title="Pogrubienie">
                                                <i class="ri-bold"></i>
                                            </button>
                                            <button type="button" data-action="format-italic" data-target="excerpt" class="px-2 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100" title="Kursywa">
                                                <i class="ri-italic"></i>
                                            </button>
                                        </div>
                                        <textarea name="${type === 'news' ? 'excerpt' : 'excerpt'}" rows="3" ${type === 'news' ? '' : 'required'} class="w-full px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary border-0 resize-none" placeholder="Kr√≥tki opis (max 300 znak√≥w)..."></textarea>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Kr√≥tkie streszczenie, kt√≥re bƒôdzie wy≈õwietlane na listach</p>
                                </div>
                                
                                ${type === 'news' ? `
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Pe≈Çna tre≈õƒá artyku≈Çu *</label>
                                    <div class="border border-gray-300 rounded-md overflow-hidden">
                                        <div class="bg-gray-50 border-b border-gray-300 px-3 py-2 flex flex-wrap gap-2">
                                            <button type="button" data-action="format-bold" data-target="contentHTML" class="px-2 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100" title="Pogrubienie">
                                                <i class="ri-bold"></i> <b>B</b>
                                            </button>
                                            <button type="button" data-action="format-italic" data-target="contentHTML" class="px-2 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100" title="Kursywa">
                                                <i class="ri-italic"></i> <i>I</i>
                                            </button>
                                            <button type="button" data-action="format-heading" data-target="contentHTML" class="px-2 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100" title="Nag≈Ç√≥wek">
                                                <i class="ri-h-1"></i> H
                                            </button>
                                            <button type="button" data-action="format-list" data-target="contentHTML" class="px-2 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100" title="Lista">
                                                <i class="ri-list-unordered"></i>
                                            </button>
                                            <button type="button" data-action="format-link" data-target="contentHTML" class="px-2 py-1 text-sm bg-white border border-gray-300 rounded hover:bg-gray-100" title="Link">
                                                <i class="ri-link"></i>
                                            </button>
                                        </div>
                                        <textarea name="contentHTML" rows="12" required class="w-full px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary border-0 resize-y" placeholder="Napisz pe≈ÇnƒÖ tre≈õƒá artyku≈Çu. Mo≈ºesz u≈ºywaƒá HTML lub zwyk≈Çego tekstu..."></textarea>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Pe≈Çna tre≈õƒá artyku≈Çu. Mo≈ºesz u≈ºywaƒá znacznik√≥w HTML dla formatowania.</p>
                                </div>
                                ` : ''}
                                
                                
                                `}
                                
                                <div class="flex justify-end space-x-4">
                                    <button type="button" data-action="close-modal" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                                        Anuluj
                                    </button>
                                    <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark">
                                        ${isEdit ? 'Zaktualizuj' : 'Dodaj'}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Add event listeners for modal close buttons
                modal.querySelectorAll('[data-action="close-modal"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        modal.remove();
                    });
                });

                // Add event listeners for text formatting buttons
                modal.querySelectorAll('[data-action^="format-"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const action = e.currentTarget.dataset.action;
                        const target = e.currentTarget.dataset.target;
                        this.formatText(action, target);
                    });
                });

                // Add event listeners for image upload (news only)
                if (type === 'news') {
                    const uploadBtn = modal.querySelector('[data-action="upload-news-image"]');
                    const removeBtn = modal.querySelector('[data-action="remove-news-image"]');
                    const fileInput = modal.querySelector('#news-image-upload');
                    
                    if (uploadBtn && fileInput) {
                        uploadBtn.addEventListener('click', () => {
                            fileInput.click();
                        });
                        
                        fileInput.addEventListener('change', (e) => {
                            this.handleNewsImageUpload(e.target.files[0]);
                        });
                    }
                    
                    if (removeBtn) {
                        removeBtn.addEventListener('click', () => {
                            this.removeNewsImage();
                        });
                    }
                }
                
                // Add event listeners for file upload (materials only)
                if (type === 'material') {
                    const uploadBtn = modal.querySelector('[data-action="upload-material-file"]');
                    const fileInput = modal.querySelector('#material-file-upload');
                    
                    if (uploadBtn && fileInput) {
                        console.log('‚úÖ Upload button and file input found for materials');
                        uploadBtn.addEventListener('click', () => {
                            console.log('üëÜ Upload button clicked');
                            fileInput.click();
                        });
                        
                        fileInput.addEventListener('change', (e) => {
                            console.log('üìÅ File selected:', e.target.files[0]?.name);
                            this.handleMaterialFileUpload(e.target.files[0]);
                        });
                    } else {
                        console.error('‚ùå Upload button or file input not found');
                        console.log('Upload button:', uploadBtn);
                        console.log('File input:', fileInput);
                    }
                }
                
                // Bind form submission
                document.getElementById(`${type}-form`).addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleSubmit(type, id);
                });
                
                // Handle isPaid checkbox for courses
                if (type === 'course') {
                    const isPaidCheckbox = document.querySelector('input[name="isPaid"]');
                    const priceField = document.getElementById('price-field');
                    
                    if (isPaidCheckbox && priceField) {
                        isPaidCheckbox.addEventListener('change', function() {
                            if (this.checked) {
                                priceField.classList.remove('hidden');
                                priceField.querySelector('input').required = true;
                            } else {
                                priceField.classList.add('hidden');
                                priceField.querySelector('input').required = false;
                                priceField.querySelector('input').value = '0';
                            }
                        });
                    }
                }
                
                // Load data if editing
                if (isEdit) {
                    this.loadDataForEdit(type, id);
                }
            }

            async loadDataForEdit(type, id) {
                try {
                    let response;
                    if (type === 'news') {
                        response = await fetch(`/api/news/id/${id}`, { credentials: 'include' });
                    } else if (type === 'course') {
                        response = await fetch(`/api/courses/id/${id}`, { credentials: 'include' });
                    } else if (type === 'material') {
                        response = await fetch(`/api/materials/${id}`, { credentials: 'include' });
                    } else {
                        response = await fetch(`/api/job-offers/id/${id}`, { credentials: 'include' });
                    }
                    
                    const data = await response.json();
                    if (response.ok) {
                        const item = data[type] || data.course || data.jobOffer || data.article || data.news || data.material;
                        const form = document.getElementById(`${type}-form`);
                        
                        // Fill form fields
                        Object.keys(item).forEach(key => {
                            const input = form.querySelector(`[name="${key}"]`);
                            if (input) {
                                if (input.type === 'checkbox') {
                                    input.checked = Boolean(item[key]);
                                } else if (input.type === 'date') {
                                    input.value = new Date(item[key]).toISOString().split('T')[0];
                                } else {
                                    input.value = item[key];
                                }
                            }
                        });
                        
                        // Special handling for checkboxes to trigger change events
                        if (type === 'course') {
                            const isPaidCheckbox = form.querySelector('input[name="isPaid"]');
                            if (isPaidCheckbox) {
                                isPaidCheckbox.dispatchEvent(new Event('change'));
                            }
                        }
                        
                        // Special handling for news image preview
                        if (type === 'news' && item.imageUrl && item.imageUrl !== './imgs/bcccuu.jpg' && item.imageUrl !== '/imgs/halazdjecie.jpg') {
                            const imageUrlInput = document.getElementById('news-image-url');
                            const previewDiv = document.getElementById('news-image-preview');
                            const previewImg = document.getElementById('news-preview-img');
                            const removeBtn = document.querySelector('[data-action="remove-news-image"]');
                            
                            if (imageUrlInput && previewDiv && previewImg && removeBtn) {
                                imageUrlInput.value = item.imageUrl;
                                previewImg.src = item.imageUrl;
                                previewDiv.classList.remove('hidden');
                                removeBtn.classList.remove('hidden');
                            }
                        }
                    }
                } catch (error) {
                    console.error('Error loading data for edit:', error);
                    this.showNotification('B≈ÇƒÖd ≈Çadowania danych do edycji', 'error');
                }
            }

            async handleSubmit(type, id = null) {
                try {
                    const form = document.getElementById(`${type}-form`);
                    const formData = new FormData(form);
                    const data = Object.fromEntries(formData.entries());
                    
                    // Handle checkboxes (they're not included in FormData if unchecked)
                    if (type === 'course') {
                        const isActiveCheckbox = form.querySelector('input[name="isActive"]');
                        const isPaidCheckbox = form.querySelector('input[name="isPaid"]');
                        
                        data.isActive = isActiveCheckbox ? isActiveCheckbox.checked : false;
                        data.isPaid = isPaidCheckbox ? isPaidCheckbox.checked : false;
                        
                        // Convert numeric fields to proper types
                        // weeks usuniƒôte z formularza kursu
                        if (data.hours) data.hours = parseInt(data.hours);
                        if (data.maxParticipants) data.maxParticipants = parseInt(data.maxParticipants);
                        if (data.price) data.price = parseFloat(data.price);
                        
                        console.log('Course data before submit:', data);
                    } else if (type === 'news' || type === 'job') {
                        const isActiveCheckbox = form.querySelector('input[name="isActive"]');
                        data.isActive = isActiveCheckbox ? isActiveCheckbox.checked : false;
                        
                        console.log(`${type} checkbox values:`, { isActive: data.isActive });
                    } else if (type === 'material') {
                        const isPublicCheckbox = form.querySelector('input[name="isPublic"]');
                        data.isPublic = isPublicCheckbox ? isPublicCheckbox.checked : false;
                        
                        console.log('Material checkbox values:', { isPublic: data.isPublic });
                    }
                    
                    const isEdit = id !== null;
                    const url = isEdit ? 
                        (type === 'news' ? `/api/news/${id}` : 
                         type === 'course' ? `/api/courses/${id}` : 
                         type === 'material' ? `/api/materials/${id}` :
                         `/api/job-offers/${id}`) :
                        (type === 'news' ? '/api/news' : 
                         type === 'course' ? '/api/courses' : 
                         type === 'material' ? '/api/materials' :
                         '/api/job-offers');
                    
                    const method = isEdit ? 'PUT' : 'POST';
                    
                    console.log('Sending data:', data);
                    console.log('URL:', url, 'Method:', method);
                    
                    const response = await fetch(url, {
                        method: method,
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        credentials: 'include',
                        body: JSON.stringify(data)
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error('API Error Response:', errorData);
                        
                        let errorMessage = errorData.message || `HTTP ${response.status}`;
                        if (errorData.errors && Array.isArray(errorData.errors)) {
                            const validationErrors = errorData.errors.map(err => err.msg || err.message).join(', ');
                            errorMessage = 'B≈Çƒôdy walidacji: ' + validationErrors;
                        }
                        
                        throw new Error(errorMessage);
                    }
                    
                    const result = await response.json();
                    
                    this.showNotification(
                        isEdit ? `${type === 'news' ? 'Aktualno≈õƒá' : type === 'course' ? 'Kurs' : type === 'material' ? 'Materia≈Ç' : 'Oferta pracy'} zosta≈Ça zaktualizowana` : 
                                `${type === 'news' ? 'Aktualno≈õƒá' : type === 'course' ? 'Kurs' : type === 'material' ? 'Materia≈Ç' : 'Oferta pracy'} zosta≈Ça dodana`, 
                        'success'
                    );
                    
                    // Close modal
                    document.getElementById('content-modal').remove();
                    
                    // Reload data
                    if (type === 'news') {
                        this.loadNews();
                    } else if (type === 'course') {
                        this.loadCourses();
                    } else if (type === 'material') {
                        this.loadMaterials();
                    } else {
                        this.loadJobs();
                    }
                    
                    // Reload dashboard
                    this.loadDashboard();
                    
                } catch (error) {
                    console.error('Error saving:', error);
                    this.showNotification(error.message, 'error');
                }
            }

            async editNews(id) {
                this.showNewsModal(id);
            }

            async editCourse(id) {
                this.showCourseModal(id);
            }

            async editJob(id) {
                this.showJobModal(id);
            }

            async deleteNews(id) {
                if (confirm('Czy na pewno chcesz usunƒÖƒá tƒô aktualno≈õƒá?')) {
                    await this.deleteItem('news', id);
                }
            }

            async deleteCourse(id) {
                if (confirm('Czy na pewno chcesz usunƒÖƒá ten kurs?')) {
                    await this.deleteItem('course', id);
                }
            }

            async deleteJob(id) {
                if (confirm('Czy na pewno chcesz usunƒÖƒá tƒô ofertƒô pracy?')) {
                    await this.deleteItem('job', id);
                }
            }

            async deleteItem(type, id) {
                try {
                    const url = type === 'news' ? `/api/news/${id}` : 
                               type === 'course' ? `/api/courses/${id}` : 
                               `/api/job-offers/${id}`;
                    
                    const response = await fetch(url, {
                        method: 'DELETE',
                        credentials: 'include'
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || `HTTP ${response.status}`);
                    }
                    
                    this.showNotification(
                        `${type === 'news' ? 'Aktualno≈õƒá' : type === 'course' ? 'Kurs' : type === 'application' ? 'Zg≈Çoszenie' : 'Oferta pracy'} zosta≈Ça usuniƒôta`, 
                        'success'
                    );
                    
                    // Reload data
                    if (type === 'news') {
                        this.loadNews();
                    } else if (type === 'course') {
                        this.loadCourses();
                    } else if (type === 'application') {
                        this.loadApplications();
                    } else {
                        this.loadJobs();
                    }
                    
                    // Reload dashboard
                    this.loadDashboard();
                    
                } catch (error) {
                    console.error('Error deleting:', error);
                    this.showNotification('B≈ÇƒÖd usuwania: ' + error.message, 'error');
                }
            }

            filterNews() {
                const filter = document.getElementById('news-status-filter').value;
                const container = document.getElementById('news-list');
                
                if (!this.news || this.news.length === 0) {
                    return;
                }
                
                let filteredNews = this.news;
                
                if (filter) {
                    filteredNews = this.news.filter(news => {
                        return news.status === filter;
                    });
                }
                
                // Re-render filtered news
                if (filteredNews.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i class="ri-newspaper-line text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 mb-4">Brak aktualno≈õci ${filter ? `ze statusem "${this.getStatusLabel(filter)}"` : ''}</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = filteredNews.map(news => `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h4 class="font-medium text-gray-900 mb-2">${news.title}</h4>
                                <p class="text-sm text-gray-600 mb-3">${news.excerpt || 'Brak opisu...'}</p>
                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                    <span><i class="ri-calendar-line mr-1"></i>${new Date(news.publishedAt || news.createdAt).toLocaleDateString('pl-PL')}</span>
                                    <span><i class="ri-user-line mr-1"></i>${news.author ? (news.author.firstName + ' ' + news.author.lastName) : 'Admin'}</span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2 ml-4">
                                <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                    news.isActive === false ? 'bg-red-100 text-red-800' :
                                    news.status === 'published' ? 'bg-green-100 text-green-800' :
                                    news.status === 'draft' ? 'bg-yellow-100 text-yellow-800' :
                                    'bg-gray-100 text-gray-800'
                                }">
                                    ${news.isActive === false ? 'Nieaktywny' : 
                                      news.status === 'published' ? 'Opublikowany' :
                                      news.status === 'draft' ? 'Szkic' : 'Zarchiwizowany'}
                                </span>
                                <button data-action="edit-news" data-id="${news._id}" class="text-blue-600 hover:text-blue-800" title="Edytuj">
                                    <i class="ri-edit-line"></i>
                                </button>
                                <button data-action="delete-news" data-id="${news._id}" class="text-red-600 hover:text-red-800" title="Usu≈Ñ">
                                    <i class="ri-delete-bin-line"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                this.addEventListeners();
            }

            async handleViewModeChange() {
                const viewMode = document.getElementById('courses-view-mode').value;
                if (viewMode === 'grouped') {
                    await this.loadGroupedCourses();
                } else {
                    await this.loadCourses();
                }
            }

            async loadGroupedCourses() {
                try {
                    const response = await fetch('/api/courses/admin/grouped', { credentials: 'include' });
                    const data = await response.json();
                    
                    if (response.ok && data.groups) {
                        this.courseGroups = data.groups || [];
                        this.renderGroupedCourses();
                    } else {
                        throw new Error(data.message || 'B≈ÇƒÖd ≈Çadowania grupowanych kurs√≥w');
                    }
                } catch (error) {
                    console.error('Error loading grouped courses:', error);
                    this.showNotification('B≈ÇƒÖd ≈Çadowania grupowanych kurs√≥w: ' + error.message, 'error');
                }
            }

            renderGroupedCourses() {
                const container = document.getElementById('courses-list');
                
                if (this.courseGroups.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i class="ri-book-line text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 mb-4">Brak kurs√≥w do grupowania</p>
                            <button data-action="add-course" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors">
                                <i class="ri-add-line mr-2"></i>
                                Dodaj pierwszy kurs
                            </button>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.courseGroups.map(group => `
                    <div class="border border-gray-200 rounded-lg p-4 mb-4">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <h4 class="text-lg font-semibold text-gray-900 mb-2">${group.title}</h4>
                                <div class="flex flex-wrap gap-2 text-sm text-gray-600">
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded">${group.totalCourses} kurs√≥w</span>
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded">${group.totalApplications} zg≈Çosze≈Ñ</span>
                                    <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded">${group.activeCount} aktywnych</span>
                                    ${group.nextStartDate ? `<span class="bg-orange-100 text-orange-800 px-2 py-1 rounded">Najbli≈ºszy: ${new Date(group.nextStartDate).toLocaleDateString('pl-PL')}</span>` : ''}
                                </div>
                            </div>
                            <button data-action="toggle-group" data-title="${group.title}" class="text-gray-500 hover:text-gray-700">
                                <i class="ri-arrow-down-s-line group-toggle-icon"></i>
                            </button>
                        </div>
                        
                        <div class="group-courses hidden">
                            ${group.courses.map(course => `
                                <div class="border-l-4 border-gray-300 pl-4 py-2 mb-2 bg-gray-50 rounded-r">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <p class="font-medium text-gray-900 mb-1">${course.title}</p>
                                            <div class="flex items-center space-x-4 text-xs text-gray-500">
                                                <span><i class="ri-user-line mr-1"></i>Grupa: ${course.targetGroup || 'doro≈õli'}</span>
                                                <span><i class="ri-time-line mr-1"></i>${course.hours || 0}h</span>
                                                <span><i class="ri-calendar-line mr-1"></i>${course.duration || 'Automatycznie generowany'}</span>
                                                <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                                    course.isActive !== false ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                                }">${course.isActive !== false ? 'Aktywny' : 'Nieaktywny'}</span>
                                                <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                                    course.status === 'published' ? 'bg-green-100 text-green-800' :
                                                    course.status === 'draft' ? 'bg-yellow-100 text-yellow-800' :
                                                    'bg-gray-100 text-gray-800'
                                                }">${
                                                    course.status === 'published' ? 'Opublikowany' : 
                                                    course.status === 'draft' ? 'Szkic' : 'Zarchiwizowany'
                                                }</span>
                                            </div>
                                        </div>
                                        <div class="flex space-x-1">
                                            <button data-action="preview-course" data-id="${course._id}" class="text-blue-600 hover:text-blue-800" title="PodglƒÖd">
                                                <i class="ri-eye-line"></i>
                                            </button>
                                            <button data-action="edit-course" data-id="${course._id}" class="text-blue-600 hover:text-blue-800" title="Edytuj">
                                                <i class="ri-edit-line"></i>
                                            </button>
                                            <button data-action="delete-course" data-id="${course._id}" class="text-red-600 hover:text-red-800" title="Usu≈Ñ">
                                                <i class="ri-delete-bin-line"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
                
                this.addEventListeners();
            }

            filterCourses() {
                const filter = document.getElementById('courses-status-filter').value;
                const viewMode = document.getElementById('courses-view-mode').value;
                const container = document.getElementById('courses-list');
                
                if (!this.courses || this.courses.length === 0) {
                    return;
                }
                
                let filteredCourses = this.courses;
                
                if (filter) {
                    filteredCourses = this.courses.filter(course => {
                        return course.status === filter;
                    });
                }
                
                if (viewMode === 'grouped') {
                    this.renderGroupedCourses(filteredCourses);
                } else {
                    this.renderCoursesList(filteredCourses);
                }
            }

            renderCoursesList(courses) {
                const container = document.getElementById('courses-list');
                
                if (courses.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i class="ri-book-line text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 mb-4">Brak kurs√≥w</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = courses.map(course => `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h4 class="font-medium text-gray-900 mb-2">${course.title}</h4>
                                <p class="text-sm text-gray-600 mb-3">${course.excerpt || 'Brak opisu...'}</p>
                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                    <span><i class="ri-time-line mr-1"></i>${course.duration || 'Brak informacji'}</span>
                                    <span><i class="ri-timer-line mr-1"></i>${course.hours || 30}h</span>
                                    <span><i class="ri-group-line mr-1"></i>${course.targetGroup || 'doro≈õli'}</span>
                                    <span><i class="ri-user-line mr-1"></i>Max: ${course.maxParticipants || 20}</span>
                                </div>
                                <div class="flex items-center space-x-2 mt-2">
                                    <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                        course.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                    }">
                                        ${course.isActive ? 'Aktywny' : 'Nieaktywny'}
                                    </span>
                                    <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                        course.isPaid ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800'
                                    }">
                                        ${course.isPaid ? 'P≈Çatny' : 'Bezp≈Çatny'}
                                    </span>
                                    ${course.isPaid && course.price > 0 ? `<span class="text-xs text-gray-600">${course.price} PLN</span>` : ''}
                                </div>
                            </div>
                            <div class="flex items-center space-x-2 ml-4">
                                <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                    course.status === 'published' ? 'bg-green-100 text-green-800' :
                                    course.status === 'draft' ? 'bg-yellow-100 text-yellow-800' :
                                    'bg-gray-100 text-gray-800'
                                }">
                                    ${course.status === 'published' ? 'Opublikowany' :
                                      course.status === 'draft' ? 'Szkic' : 'Zarchiwizowany'}
                                </span>
                                <button data-action="preview-course" data-id="${course._id}" class="text-blue-600 hover:text-blue-800" title="PodglƒÖd">
                                    <i class="ri-eye-line"></i>
                                </button>
                                <button data-action="edit-course" data-id="${course._id}" class="text-blue-600 hover:text-blue-800" title="Edytuj">
                                    <i class="ri-edit-line"></i>
                                </button>
                                <button data-action="delete-course" data-id="${course._id}" class="text-red-600 hover:text-red-800" title="Usu≈Ñ">
                                    <i class="ri-delete-bin-line"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                this.addEventListeners();
            }

            renderGroupedCourses(courses) {
                const container = document.getElementById('courses-list');
                
                if (courses.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i class="ri-book-line text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 mb-4">Brak kurs√≥w</p>
                        </div>
                    `;
                    return;
                }

                // Group courses by title
                const groupedCourses = courses.reduce((groups, course) => {
                    const groupName = course.title;
                    if (!groups[groupName]) {
                        groups[groupName] = [];
                    }
                    groups[groupName].push(course);
                    return groups;
                }, {});

                const groupsArray = Object.keys(groupedCourses).map(title => ({
                    title,
                    courses: groupedCourses[title],
                    count: groupedCourses[title].length
                }));

                container.innerHTML = groupsArray.map(group => `
                    <div class="border border-gray-200 rounded-lg p-4 mb-4 bg-white shadow-sm">
                        <div class="flex items-start justify-between mb-4 cursor-pointer" data-action="toggle-course-group" data-group="${group.title}">
                            <div class="flex-1">
                                <h4 class="font-medium text-gray-900 mb-1">${group.title}</h4>
                                <p class="text-sm text-gray-500">Liczba kurs√≥w: ${group.count}</p>
                            </div>
                            <div class="flex items-center">
                                <i class="ri-arrow-down-s-line text-gray-400 group-toggle-icon"></i>
                            </div>
                        </div>
                        
                        <div class="group-courses hidden">
                            ${group.courses.map(course => `
                                <div class="border-l-4 border-gray-300 pl-4 py-2 mb-2 bg-gray-50 rounded-r">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <p class="font-medium text-gray-900 mb-1">${course.title}</p>
                                            <div class="flex items-center space-x-4 text-xs text-gray-500">
                                                <span><i class="ri-user-line mr-1"></i>Grupa: ${course.targetGroup || 'doro≈õli'}</span>
                                                <span><i class="ri-time-line mr-1"></i>${course.hours || 0}h</span>
                                                <span><i class="ri-calendar-line mr-1"></i>${course.duration || 'Automatycznie generowany'}</span>
                                                <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                                    course.isActive !== false ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                                }">${course.isActive !== false ? 'Aktywny' : 'Nieaktywny'}</span>
                                                <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                                    course.status === 'published' ? 'bg-green-100 text-green-800' :
                                                    course.status === 'draft' ? 'bg-yellow-100 text-yellow-800' :
                                                    'bg-gray-100 text-gray-800'
                                                }">${
                                                    course.status === 'published' ? 'Opublikowany' :
                                                    course.status === 'draft' ? 'Szkic' : 'Zarchiwizowany'
                                                }</span>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-2 ml-4">
                                            <button data-action="preview-course" data-id="${course._id}" class="text-blue-600 hover:text-blue-800 text-xs" title="PodglƒÖd">
                                                <i class="ri-eye-line"></i>
                                            </button>
                                            <button data-action="edit-course" data-id="${course._id}" class="text-blue-600 hover:text-blue-800 text-xs" title="Edytuj">
                                                <i class="ri-edit-line"></i>
                                            </button>
                                            <button data-action="delete-course" data-id="${course._id}" class="text-red-600 hover:text-red-800 text-xs" title="Usu≈Ñ">
                                                <i class="ri-delete-bin-line"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
                
                this.addEventListeners();
            }

            filterJobs() {
                const filter = document.getElementById('jobs-status-filter').value;
                const container = document.getElementById('jobs-list');
                
                if (!this.jobs || this.jobs.length === 0) {
                    return;
                }
                
                let filteredJobs = this.jobs;
                
                if (filter) {
                    filteredJobs = this.jobs.filter(job => {
                        return job.status === filter;
                    });
                }
                
                // Re-render filtered jobs
                if (filteredJobs.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i class="ri-briefcase-line text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 mb-4">Brak ofert pracy ${filter ? `ze statusem "${this.getStatusLabel(filter)}"` : ''}</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = filteredJobs.map(job => `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h4 class="font-medium text-gray-900 mb-2">${job.title}</h4>
                                <p class="text-sm text-gray-600 mb-3">${job.excerpt || 'Brak opisu...'}</p>
                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                    <span><i class="ri-map-pin-line mr-1"></i>${job.location || 'Brak lokalizacji'}</span>
                                    <span><i class="ri-time-line mr-1"></i>${job.workType || 'Brak informacji'}</span>
                                    ${job.salary ? `<span><i class="ri-money-dollar-circle-line mr-1"></i>${job.salary}</span>` : ''}
                                </div>
                            </div>
                            <div class="flex items-center space-x-2 ml-4">
                                <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                    job.status === 'published' ? 'bg-green-100 text-green-800' :
                                    job.status === 'draft' ? 'bg-yellow-100 text-yellow-800' :
                                    'bg-gray-100 text-gray-800'
                                }">
                                    ${job.status === 'published' ? 'Opublikowana' :
                                      job.status === 'draft' ? 'Szkic' : 'Zarchiwizowana'}
                                </span>
                                <button data-action="edit-job" data-id="${job._id}" class="text-blue-600 hover:text-blue-800" title="Edytuj">
                                    <i class="ri-edit-line"></i>
                                </button>
                                <button data-action="delete-job" data-id="${job._id}" class="text-red-600 hover:text-red-800" title="Usu≈Ñ">
                                    <i class="ri-delete-bin-line"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                this.addEventListeners();
            }

            filterMaterials() {
                const typeFilter = document.getElementById('materials-type-filter').value;
                const levelFilter = document.getElementById('materials-level-filter').value;
                const publicFilter = document.getElementById('materials-public-filter').value;
                const container = document.getElementById('materials-list');
                
                if (!this.materials || this.materials.length === 0) {
                    return;
                }
                
                let filteredMaterials = this.materials;
                
                // Apply type filter
                if (typeFilter) {
                    filteredMaterials = filteredMaterials.filter(material => {
                        return material.type === typeFilter;
                    });
                }
                
                // Apply level filter
                if (levelFilter) {
                    filteredMaterials = filteredMaterials.filter(material => {
                        return material.level === levelFilter;
                    });
                }
                
                // Apply public filter
                if (publicFilter) {
                    const isPublic = publicFilter === 'true';
                    filteredMaterials = filteredMaterials.filter(material => {
                        return material.isPublic === isPublic;
                    });
                }
                
                // Re-render filtered materials
                if (filteredMaterials.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i class="ri-file-list-line text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 mb-4">Brak materia≈Ç√≥w spe≈ÇniajƒÖcych kryteria filtrowania</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = filteredMaterials.map(material => `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h4 class="font-medium text-gray-900 mb-2">${material.title}</h4>
                                <p class="text-sm text-gray-600 mb-3">${material.description || 'Brak opisu...'}</p>
                                <div class="flex items-center space-x-4 text-sm text-gray-500">
                                    <span><i class="ri-file-line mr-1"></i>Typ: ${this.getMaterialTypeLabel(material.type)}</span>
                                    <span><i class="ri-bar-chart-line mr-1"></i>Poziom: ${this.getMaterialLevelLabel(material.level)}</span>
                                    ${material.fileSize ? `<span><i class="ri-file-text-line mr-1"></i>${material.fileSize}</span>` : ''}
                                </div>
                            </div>
                            <div class="flex items-center space-x-2 ml-4">
                                <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                    material.isPublic ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'
                                }">
                                    ${material.isPublic ? 'Publiczny' : 'Prywatny'}
                                </span>
                                <button data-action="edit-material" data-id="${material._id}" class="text-blue-600 hover:text-blue-800" title="Edytuj">
                                    <i class="ri-edit-line"></i>
                                </button>
                                <button data-action="delete-material" data-id="${material._id}" class="text-red-600 hover:text-red-800" title="Usu≈Ñ">
                                    <i class="ri-delete-bin-line"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                this.addEventListeners();
            }

            getStatusLabel(status) {
                const labels = {
                    'published': 'Opublikowane',
                    'draft': 'Szkice',
                    'archived': 'Zarchiwizowane'
                };
                return labels[status] || status;
            }

            getMaterialTypeLabel(type) {
                const labels = {
                    'document': 'Dokument',
                    'video': 'Film',
                    'image': 'Obraz',
                    'audio': 'Audio',
                    'test': 'Test',
                    'link': 'Link'
                };
                return labels[type] || type;
            }

            getMaterialLevelLabel(level) {
                const labels = {
                    'beginner': 'PoczƒÖtkujƒÖcy',
                    'intermediate': '≈öredniozaawansowany',
                    'advanced': 'Zaawansowany'
                };
                return labels[level] || level;
            }

            async loadApplications() {
                try {
                    // Zawsze u≈ºywaj widoku pogrupowanego wed≈Çug kurs√≥w
                    const response = await fetch('/api/applications/admin/grouped', { credentials: 'include' });
                    const data = await response.json();
                    
                    if (response.ok && data.groups) {
                        this.applicationGroups = data.groups || [];
                        this.renderGroupedApplications();
                        this.addEventListeners();
                    } else {
                        throw new Error(data.message || 'B≈ÇƒÖd ≈Çadowania zg≈Çosze≈Ñ');
                    }
                } catch (error) {
                    console.error('Error loading applications:', error);
                    this.showNotification('B≈ÇƒÖd ≈Çadowania zg≈Çosze≈Ñ: ' + error.message, 'error');
                }
            }

            renderGroupedApplications() {
                const container = document.getElementById('applications-list');
                
                if (this.applicationGroups.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i class="ri-folder-line text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 mb-4">Brak zg≈Çosze≈Ñ na kursy</p>
                            <p class="text-xs text-gray-400">Zg≈Çoszenia bƒôdƒÖ automatycznie grupowane wed≈Çug nazw kurs√≥w</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.applicationGroups.map(group => `
                    <div class="border border-gray-200 rounded-lg p-4 mb-4 bg-white shadow-sm">
                        <div class="flex items-start justify-between mb-4 cursor-pointer" data-action="toggle-application-group" data-group="${group.courseTitle}">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <i class="ri-folder-line text-blue-600 mr-2"></i>
                                    <h4 class="text-lg font-semibold text-gray-900">${group.courseTitle}</h4>
                                </div>
                                <div class="flex flex-wrap gap-2 text-sm">
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium">
                                        ${group.totalApplications} zg≈Çosze≈Ñ
                                    </span>
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">
                                        ${group.statusCounts.accepted} zaakceptowane
                                    </span>
                                    <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-medium">
                                        ${group.statusCounts.new + group.statusCounts.waiting} oczekujƒÖce
                                    </span>
                                    <span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium">
                                        ${group.statusCounts.rejected} odrzucone
                                    </span>
                                    ${group.startDate ? `<span class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs font-medium">
                                        Start: ${new Date(group.startDate).toLocaleDateString('pl-PL')}
                                    </span>` : ''}
                                </div>
                            </div>
                            <button class="text-gray-500 hover:text-gray-700 p-1">
                                <i class="ri-arrow-down-s-line application-group-toggle-icon"></i>
                            </button>
                        </div>
                        
                        <div class="application-group-content hidden">
                            <div class="border-t border-gray-200 pt-4">
                                ${group.applications.map(app => `
                                    <div class="border-l-4 border-blue-300 pl-4 py-3 mb-3 bg-gray-50 rounded-r-lg hover:bg-gray-100 transition-colors">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1">
                                                <h5 class="font-medium text-gray-900 mb-1">${app.firstName} ${app.lastName}</h5>
                                                <p class="text-sm text-gray-600 mb-2">${app.email} ‚Ä¢ ${app.phone}</p>
                                                <div class="flex items-center space-x-4 text-xs text-gray-500">
                                                    <span><i class="ri-calendar-line mr-1"></i>${new Date(app.createdAt).toLocaleDateString('pl-PL')}</span>
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-2 ml-4">
                                                <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                                    app.status === 'accepted' ? 'bg-green-100 text-green-800' :
                                                    app.status === 'rejected' ? 'bg-red-100 text-red-800' :
                                                    app.status === 'waiting' ? 'bg-yellow-100 text-yellow-800' :
                                                    'bg-blue-100 text-blue-800'
                                                }">
                                                    ${app.status === 'accepted' ? 'Zaakceptowane' : 
                                                      app.status === 'rejected' ? 'Odrzucone' : 
                                                      app.status === 'waiting' ? 'OczekujƒÖce' : 'Nowe'}
                                                </span>
                                                <button data-action="view-application" data-id="${app._id}" class="text-blue-600 hover:text-blue-800" title="Zobacz szczeg√≥≈Çy">
                                                    <i class="ri-eye-line"></i>
                                                </button>
                                                <button data-action="accept-application" data-id="${app._id}" class="text-green-600 hover:text-green-800" title="Zaakceptuj">
                                                    <i class="ri-check-line"></i>
                                                </button>
                                                <button data-action="reject-application" data-id="${app._id}" class="text-red-600 hover:text-red-800" title="Odrzuƒá">
                                                    <i class="ri-close-line"></i>
                                                </button>
                                                <button data-action="delete-application" data-id="${app._id}" class="text-red-600 hover:text-red-800" title="Usu≈Ñ zg≈Çoszenie">
                                                    <i class="ri-delete-bin-line"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            async viewApplication(id) {
                try {
                    const response = await fetch(`/api/applications/id/${id}`, { credentials: 'include' });
                    const data = await response.json();
                    
                    if (data.success) {
                        const app = data.application;
                        this.showApplicationModal(app);
                    }
                } catch (error) {
                    this.showNotification('B≈ÇƒÖd ≈Çadowania zg≈Çoszenia: ' + error.message, 'error');
                }
            }

            showApplicationModal(application) {
                const modal = document.getElementById('applicationModal');
                const detailsContainer = document.getElementById('applicationDetails');
                const printDateSpan = document.getElementById('printDate');
                
                // Set current print date
                printDateSpan.textContent = new Date().toLocaleDateString('pl-PL', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                // Format status display
                const statusLabels = {
                    'new': 'Nowe',
                    'accepted': 'Zaakceptowane',
                    'rejected': 'Odrzucone',
                    'waiting': 'Oczekuje'
                };

                // Generate application details HTML
                detailsContainer.innerHTML = `
                    <!-- Course Information Section - First -->
                    <div class="print-section">
                        <div class="print-section-title">Kurs</div>
                        <div class="print-field">
                            <div class="print-field-label">Nazwa kursu:</div>
                            <div class="print-field-value">${application.courseTitle || application.course?.title || 'Brak'}</div>
                        </div>
                    </div>

                    <!-- Personal Information Section - Second -->
                    <div class="print-section">
                        <div class="print-section-title">Dane osobowe</div>
                        <div class="print-field">
                            <div class="print-field-label">Imiƒô i nazwisko:</div>
                            <div class="print-field-value">${application.firstName || 'Brak'} ${application.lastName || ''}</div>
                        </div>
                        <div class="print-field">
                            <div class="print-field-label">Email:</div>
                            <div class="print-field-value">${application.email || 'Brak'}</div>
                        </div>
                        <div class="print-field">
                            <div class="print-field-label">Telefon:</div>
                            <div class="print-field-value">${application.phone || 'Brak'}</div>
                        </div>
                    </div>

                    <!-- Basic Information Section - Third -->
                    <div class="print-section">
                        <div class="print-section-title">Informacje o zg≈Çoszeniu</div>
                        <div class="print-field">
                            <div class="print-field-label">Data zg≈Çoszenia:</div>
                            <div class="print-field-value">${new Date(application.createdAt).toLocaleDateString('pl-PL', {
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}</div>
                        </div>
                        ${application.reviewedAt ? `
                        <div class="print-field">
                            <div class="print-field-label">Data weryfikacji:</div>
                            <div class="print-field-value">${new Date(application.reviewedAt).toLocaleDateString('pl-PL', {
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}</div>
                        </div>
                        ` : ''}
                    </div>

                    ${application.motivation ? `
                    <!-- Motivation Section -->
                    <div class="print-section">
                        <div class="print-section-title">Motywacja</div>
                        <div class="print-field">
                            <div class="print-field-value" style="width: 100%; white-space: pre-wrap;">${application.motivation}</div>
                        </div>
                    </div>
                    ` : ''}

                    <!-- RODO Consents Section -->
                    <div class="print-section">
                        <div class="print-section-title">Zgody RODO</div>
                        <div class="print-field">
                            <div class="print-field-label">Zgoda RODO:</div>
                            <div class="print-field-value">${application.consentRODO ? '‚úì Wyra≈ºona' : '‚úó Nie wyra≈ºona'}</div>
                        </div>
                        <div class="print-field">
                            <div class="print-field-label">Zgoda marketingowa:</div>
                            <div class="print-field-value">${application.consentMarketing ? '‚úì Wyra≈ºona' : '‚úó Nie wyra≈ºona'}</div>
                        </div>
                    </div>

                    ${application.notes ? `
                    <!-- Notes Section -->
                    <div class="print-section">
                        <div class="print-section-title">Notatki administratora</div>
                        <div class="print-field">
                            <div class="print-field-value" style="width: 100%; white-space: pre-wrap;">${application.notes}</div>
                        </div>
                    </div>
                    ` : ''}
                `;

                // Show modal
                modal.classList.add('show');

                // Add event listeners for modal
                this.addApplicationModalListeners();
            }

            addApplicationModalListeners() {
                const modal = document.getElementById('applicationModal');
                const closeBtn = document.getElementById('closeApplicationModal');
                const printBtn = document.getElementById('printApplicationBtn');

                // Remove existing listeners to prevent duplicates
                closeBtn.onclick = null;
                printBtn.onclick = null;
                modal.onclick = null;

                // Close modal on close button click
                closeBtn.onclick = () => {
                    modal.classList.remove('show');
                };

                // Close modal on outside click
                modal.onclick = (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('show');
                    }
                };

                // Print functionality
                printBtn.onclick = () => {
                    window.print();
                };

                // Close modal on escape key (add only once)
                if (!this.escapeListenerAdded) {
                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape' && modal.classList.contains('show')) {
                            modal.classList.remove('show');
                        }
                    });
                    this.escapeListenerAdded = true;
                }
            }

            async updateApplicationStatus(id, status) {
                try {
                    const response = await fetch(`/api/applications/${id}/status`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include',
                        body: JSON.stringify({ status })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.showNotification(`Zg≈Çoszenie zosta≈Ço ${status === 'accepted' ? 'zaakceptowane' : 'odrzucone'}`, 'success');
                        this.loadApplications(); // Reload course applications list
                        this.loadJobApplications(); // Reload job applications list
                    } else {
                        throw new Error(data.message || 'B≈ÇƒÖd aktualizacji');
                    }
                } catch (error) {
                    this.showNotification('B≈ÇƒÖd aktualizacji zg≈Çoszenia: ' + error.message, 'error');
                }
            }

            async deleteApplication(id) {
                if (confirm('Czy na pewno chcesz usunƒÖƒá to zg≈Çoszenie? Ta operacja jest nieodwracalna.')) {
                    try {
                        const response = await fetch(`/api/applications/${id}`, {
                            method: 'DELETE',
                            credentials: 'include'
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            this.showNotification('Zg≈Çoszenie zosta≈Ço usuniƒôte', 'success');
                            this.loadApplications(); // Reload course applications list
                            this.loadJobApplications(); // Reload job applications list
                        } else {
                            throw new Error(data.message || 'B≈ÇƒÖd usuwania');
                        }
                    } catch (error) {
                        this.showNotification('B≈ÇƒÖd usuwania zg≈Çoszenia: ' + error.message, 'error');
                    }
                }
            }

            async loadJobApplications() {
                try {
                    // U≈ºywaj widoku pogrupowanego wed≈Çug ofert pracy
                    const response = await fetch('/api/applications/admin/job-applications/grouped', { credentials: 'include' });
                    const data = await response.json();
                    
                    if (response.ok && data.groups) {
                        this.jobApplicationGroups = data.groups || [];
                        this.renderGroupedJobApplications();
                        this.addEventListeners();
                    } else {
                        throw new Error(data.message || 'B≈ÇƒÖd ≈Çadowania aplikacji');
                    }
                } catch (error) {
                    console.error('Error loading job applications:', error);
                    this.showNotification('B≈ÇƒÖd ≈Çadowania aplikacji: ' + error.message, 'error');
                }
            }

            renderGroupedJobApplications() {
                const container = document.getElementById('job-applications-list');
                
                if (this.jobApplicationGroups.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i class="ri-briefcase-line text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 mb-4">Brak aplikacji do ofert pracy</p>
                            <p class="text-xs text-gray-400">Aplikacje bƒôdƒÖ automatycznie grupowane wed≈Çug nazw ofert pracy</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.jobApplicationGroups.map(group => `
                    <div class="border border-gray-200 rounded-lg p-4 mb-4 bg-white shadow-sm">
                        <div class="flex items-start justify-between mb-4 cursor-pointer" data-action="toggle-job-application-group" data-group="${group.jobOfferTitle}">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <i class="ri-briefcase-line text-blue-600 mr-2"></i>
                                    <h4 class="text-lg font-semibold text-gray-900">${group.jobOfferTitle}</h4>
                                </div>
                                <div class="flex items-center mb-2 text-sm text-gray-600">
                                    <i class="ri-building-line mr-1"></i>
                                    <span class="mr-4">${group.companyName}</span>
                                    <i class="ri-map-pin-line mr-1"></i>
                                    <span>${group.location}</span>
                                    ${group.expireAt ? `<span class="ml-4 text-red-600"><i class="ri-calendar-line mr-1"></i>Wygasa: ${new Date(group.expireAt).toLocaleDateString('pl-PL')}</span>` : ''}
                                </div>
                                <div class="flex flex-wrap gap-2 text-sm">
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium">
                                        ${group.totalApplications} aplikacji
                                    </span>
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">
                                        ${group.statusCounts.accepted} zaakceptowane
                                    </span>
                                    <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-medium">
                                        ${group.statusCounts.new + group.statusCounts.waiting} oczekujƒÖce
                                    </span>
                                    <span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium">
                                        ${group.statusCounts.rejected} odrzucone
                                    </span>
                                </div>
                            </div>
                            <button class="text-gray-500 hover:text-gray-700 p-1">
                                <i class="ri-arrow-down-s-line job-application-group-toggle-icon"></i>
                            </button>
                        </div>
                        
                        <div class="job-application-group-content hidden">
                            <div class="border-t border-gray-200 pt-4">
                                ${group.applications.map(app => `
                                    <div class="border-l-4 border-blue-300 pl-4 py-3 mb-3 bg-gray-50 rounded-r-lg hover:bg-gray-100 transition-colors">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1">
                                                <h5 class="font-medium text-gray-900 mb-1">${app.firstName} ${app.lastName}</h5>
                                                <p class="text-sm text-gray-600 mb-2">${app.email} ‚Ä¢ ${app.phone}</p>
                                                ${app.company ? `<p class="text-xs text-gray-500 mb-1">Obecna firma: ${app.company}</p>` : ''}
                                                ${app.position ? `<p class="text-xs text-gray-500 mb-1">Obecne stanowisko: ${app.position}</p>` : ''}
                                                <div class="flex items-center space-x-4 text-xs text-gray-500">
                                                    <span><i class="ri-calendar-line mr-1"></i>${new Date(app.createdAt).toLocaleDateString('pl-PL')}</span>
                                                    <span><i class="ri-user-line mr-1"></i>Do≈õwiadczenie: ${app.experience}</span>
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-2 ml-4">
                                                <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                                    app.status === 'accepted' ? 'bg-green-100 text-green-800' :
                                                    app.status === 'rejected' ? 'bg-red-100 text-red-800' :
                                                    app.status === 'waiting' ? 'bg-yellow-100 text-yellow-800' :
                                                    'bg-blue-100 text-blue-800'
                                                }">
                                                    ${app.status === 'accepted' ? 'Zaakceptowane' : 
                                                      app.status === 'rejected' ? 'Odrzucone' : 
                                                      app.status === 'waiting' ? 'OczekujƒÖce' : 'Nowe'}
                                                </span>
                                                <button data-action="view-application" data-id="${app._id}" class="text-blue-600 hover:text-blue-800" title="Zobacz szczeg√≥≈Çy">
                                                    <i class="ri-eye-line"></i>
                                                </button>
                                                <button data-action="accept-application" data-id="${app._id}" class="text-green-600 hover:text-green-800" title="Zaakceptuj">
                                                    <i class="ri-check-line"></i>
                                                </button>
                                                <button data-action="reject-application" data-id="${app._id}" class="text-red-600 hover:text-red-800" title="Odrzuƒá">
                                                    <i class="ri-close-line"></i>
                                                </button>
                                                <button data-action="delete-application" data-id="${app._id}" class="text-red-600 hover:text-red-800" title="Usu≈Ñ aplikacjƒô">
                                                    <i class="ri-delete-bin-line"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            async loadMaterials() {
                try {
                    const response = await fetch('/api/materials', { credentials: 'include' });
                    const data = await response.json();
                    
                    if (response.ok && data.materials) {
                        this.materials = data.materials || [];
                        this.renderMaterials();
                        this.addEventListeners();
                    } else {
                        throw new Error(data.message || 'B≈ÇƒÖd ≈Çadowania materia≈Ç√≥w');
                    }
                } catch (error) {
                    console.error('Error loading materials:', error);
                    this.showNotification('B≈ÇƒÖd ≈Çadowania materia≈Ç√≥w: ' + error.message, 'error');
                }
            }

            renderMaterials() {
                const container = document.getElementById('materials-list');
                
                if (this.materials.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <i class="ri-folder-download-line text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 mb-4">Brak materia≈Ç√≥w edukacyjnych</p>
                            <button data-action="add-material" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors">
                                <i class="ri-add-line mr-2"></i>
                                Dodaj pierwszy materia≈Ç
                            </button>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.materials.map(material => `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <i class="ri-${this.getMaterialIcon(material.type)}-line text-blue-600 mr-2"></i>
                                    <h4 class="font-medium text-gray-900">${material.title}</h4>
                                </div>
                                <p class="text-sm text-gray-600 mb-3">${material.description || 'Brak opisu...'}</p>
                                <div class="flex items-center space-x-4 text-xs text-gray-500 mb-2">
                                    <span class="px-2 py-1 rounded-full text-xs font-medium ${this.getTypeColor(material.type)}">
                                        ${this.getTypeLabel(material.type)}
                                    </span>
                                    <span class="px-2 py-1 rounded-full text-xs font-medium ${this.getLevelColor(material.level)}">
                                        ${this.getLevelLabel(material.level)}
                                    </span>
                                    <span class="px-2 py-1 rounded-full text-xs font-medium ${material.isPublic ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                        ${material.isPublic ? 'Publiczny' : 'Prywatny'}
                                    </span>
                                </div>
                                <div class="flex items-center space-x-4 text-xs text-gray-500">
                                    <span><i class="ri-download-line mr-1"></i>Pobra≈Ñ: ${material.downloadCount || 0}</span>
                                    <span><i class="ri-calendar-line mr-1"></i>${new Date(material.createdAt).toLocaleDateString('pl-PL')}</span>
                                    ${material.courses && material.courses.length > 0 ? `<span><i class="ri-book-line mr-1"></i>Kursy: ${material.courses.length}</span>` : ''}
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button data-action="preview-material" data-id="${material._id}" class="text-blue-600 hover:text-blue-800" title="PodglƒÖd">
                                    <i class="ri-eye-line"></i>
                                </button>
                                <button data-action="download-material" data-id="${material._id}" class="text-green-600 hover:text-green-800" title="Pobierz">
                                    <i class="ri-download-line"></i>
                                </button>
                                <button data-action="edit-material" data-id="${material._id}" class="text-blue-600 hover:text-blue-800" title="Edytuj">
                                    <i class="ri-edit-line"></i>
                                </button>
                                <button data-action="delete-material" data-id="${material._id}" class="text-red-600 hover:text-red-800" title="Usu≈Ñ">
                                    <i class="ri-delete-bin-line"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            getMaterialIcon(type) {
                const icons = {
                    'document': 'file-text',
                    'video': 'video',
                    'presentation': 'slideshow',
                    'exercise': 'pencil',
                    'test': 'question',
                    'link': 'external-link'
                };
                return icons[type] || 'file';
            }

            getTypeColor(type) {
                const colors = {
                    'document': 'bg-blue-100 text-blue-800',
                    'video': 'bg-red-100 text-red-800',
                    'presentation': 'bg-orange-100 text-orange-800',
                    'exercise': 'bg-green-100 text-green-800',
                    'test': 'bg-purple-100 text-purple-800',
                    'link': 'bg-cyan-100 text-cyan-800'
                };
                return colors[type] || 'bg-gray-100 text-gray-800';
            }

            getTypeLabel(type) {
                const labels = {
                    'document': 'Dokument',
                    'video': 'Film',
                    'presentation': 'Prezentacja',
                    'exercise': 'ƒÜwiczenie',
                    'test': 'Test',
                    'link': 'Link'
                };
                return labels[type] || type;
            }

            getLevelColor(level) {
                const colors = {
                    'beginner': 'bg-green-100 text-green-800',
                    'intermediate': 'bg-yellow-100 text-yellow-800',
                    'advanced': 'bg-red-100 text-red-800'
                };
                return colors[level] || 'bg-gray-100 text-gray-800';
            }

            getLevelLabel(level) {
                const labels = {
                    'beginner': 'PoczƒÖtkujƒÖcy',
                    'intermediate': '≈öredniozaawansowany',
                    'advanced': 'Zaawansowany'
                };
                return labels[level] || level;
            }

            showMaterialModal(materialId = null) {
                // Create modal for material
                this.createModal('material', materialId);
            }

            async previewMaterial(id) {
                try {
                    const response = await fetch(`/api/materials/${id}`, { credentials: 'include' });
                    const data = await response.json();
                    
                    if (response.ok && data.material) {
                        const material = data.material;
                        this.showMaterialPreviewModal(material);
                    }
                } catch (error) {
                    this.showNotification('B≈ÇƒÖd ≈Çadowania materia≈Çu: ' + error.message, 'error');
                }
            }

            showMaterialPreviewModal(material) {
                // Remove existing modal
                const existingModal = document.getElementById('preview-modal');
                if (existingModal) {
                    existingModal.remove();
                }

                const modal = document.createElement('div');
                modal.id = 'preview-modal';
                modal.className = 'modal show';
                
                modal.innerHTML = `
                    <div class="modal-content w-full max-w-3xl mx-4">
                        <div class="bg-white rounded-lg shadow-xl">
                            <div class="p-6 border-b border-gray-200">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h2 class="text-xl font-bold text-gray-900 mb-2">${material.title}</h2>
                                        <div class="flex items-center space-x-4 text-sm text-gray-600">
                                            <span><i class="ri-bookmark-line mr-1"></i>Typ: ${this.getMaterialTypeLabel(material.type)}</span>
                                        </div>
                                    </div>
                                    <button data-action="close-preview" class="text-gray-500 hover:text-gray-700 text-2xl hover:bg-gray-100 rounded-full w-8 h-8 flex items-center justify-center transition-colors">&times;</button>
                                </div>
                            </div>
                            
                            <div class="p-6">
                                ${material.description ? `
                                    <div class="mb-4">
                                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Opis materia≈Çu</h3>
                                        <div class="prose max-w-none text-gray-700">${material.description}</div>
                                    </div>
                                ` : ''}
                                
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <strong class="text-gray-900">URL pliku:</strong>
                                        <p class="text-gray-600 break-all">${material.fileUrl}</p>
                                    </div>
                                    <div>
                                        <strong class="text-gray-900">Status:</strong>
                                        <span class="inline-block px-2 py-1 rounded-full text-xs font-medium ml-2 ${
                                            material.isPublic ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'
                                        }">
                                            ${material.isPublic ? 'Publiczny' : 'Prywatny'}
                                        </span>
                                    </div>
                                    <div>
                                        <strong class="text-gray-900">Liczba pobra≈Ñ:</strong>
                                        <p class="text-gray-600">${material.downloadCount || 0}</p>
                                    </div>
                                    <div>
                                        <strong class="text-gray-900">Data utworzenia:</strong>
                                        <p class="text-gray-600">${new Date(material.createdAt).toLocaleDateString('pl-PL')}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="p-6 border-t border-gray-200 flex justify-end space-x-4">
                                <button data-action="download-preview" data-id="${material._id}" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                                    <i class="ri-download-line mr-2"></i>
                                    Pobierz plik
                                </button>
                                <button data-action="close-preview" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors">
                                    Zamknij
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Add event listeners
                modal.querySelectorAll('[data-action="close-preview"]').forEach(button => {
                    button.addEventListener('click', () => {
                        modal.remove();
                    });
                });
                
                const downloadBtn = modal.querySelector('[data-action="download-preview"]');
                if (downloadBtn) {
                    downloadBtn.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.downloadMaterial(id);
                        modal.remove();
                    });
                }
                
                // Close on outside click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            }

            async previewCourse(id) {
                try {
                    const response = await fetch(`/api/courses/${id}`, { credentials: 'include' });
                    const data = await response.json();
                    
                    if (response.ok && data.course) {
                        const course = data.course;
                        this.showCoursePreviewModal(course);
                    }
                } catch (error) {
                    this.showNotification('B≈ÇƒÖd ≈Çadowania kursu: ' + error.message, 'error');
                }
            }

            showCoursePreviewModal(course) {
                // Remove existing modal
                const existingModal = document.getElementById('preview-modal');
                if (existingModal) {
                    existingModal.remove();
                }

                const modal = document.createElement('div');
                modal.id = 'preview-modal';
                modal.className = 'modal show';
                
                modal.innerHTML = `
                    <div class="modal-content w-full max-w-4xl mx-4">
                        <div class="bg-white rounded-lg shadow-xl">
                            <div class="p-6 border-b border-gray-200">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h2 class="text-2xl font-bold text-gray-900 mb-2">${course.title}</h2>
                                        <div class="flex items-center space-x-4 text-sm text-gray-600 mb-3">
                                            <span><i class="ri-time-line mr-1"></i>Czas trwania: ${course.duration || 'Brak informacji'}</span>
                                            <span><i class="ri-calendar-line mr-1"></i>Tygodni: ${course.weeks || 0}</span>
                                            <span><i class="ri-timer-line mr-1"></i>Godzin: ${course.hours || 0}</span>
                                            <span><i class="ri-group-line mr-1"></i>Grupa: ${course.targetGroup || 'doro≈õli'}</span>
                                            <span><i class="ri-user-line mr-1"></i>Max: ${course.maxParticipants || 20}</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                                course.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                            }">
                                                ${course.isActive ? 'Aktywny' : 'Nieaktywny'}
                                            </span>
                                            <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                                course.isPaid ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800'
                                            }">
                                                ${course.isPaid ? 'P≈Çatny' : 'Bezp≈Çatny'}
                                            </span>
                                            ${course.isPaid && course.price > 0 ? `<span class="text-xs text-gray-600">${course.price} PLN</span>` : ''}
                                            <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${
                                                course.status === 'published' ? 'bg-green-100 text-green-800' :
                                                course.status === 'draft' ? 'bg-yellow-100 text-yellow-800' :
                                                'bg-gray-100 text-gray-800'
                                            }">
                                                ${course.status === 'published' ? 'Opublikowany' :
                                                  course.status === 'draft' ? 'Szkic' : 'Zarchiwizowany'}
                                            </span>
                                        </div>
                                    </div>
                                    <button data-action="close-preview" class="text-gray-500 hover:text-gray-700 text-2xl hover:bg-gray-100 rounded-full w-8 h-8 flex items-center justify-center transition-colors">&times;</button>
                                </div>
                            </div>
                            
                            <div class="p-6">
                                ${course.excerpt ? `
                                    <div class="mb-4">
                                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Kr√≥tki opis</h3>
                                        <p class="text-gray-700">${course.excerpt}</p>
                                    </div>
                                ` : ''}
                                
                                ${course.contentHTML ? `
                                    <div class="mb-4">
                                        <h3 class="text-lg font-semibold text-gray-900 mb-3">Program kursu</h3>
                                        <div class="prose max-w-none text-gray-700">${course.contentHTML}</div>
                                    </div>
                                ` : ''}
                                
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <strong class="text-gray-900">Autor:</strong>
                                        <p class="text-gray-600">${course.author ? course.author.firstName + ' ' + course.author.lastName : 'Brak autora'}</p>
                                    </div>
                                    <div>
                                        <strong class="text-gray-900">Slug URL:</strong>
                                        <p class="text-gray-600">${course.slug || 'Automatycznie generowany'}</p>
                                    </div>
                                    <div>
                                        <strong class="text-gray-900">Data utworzenia:</strong>
                                        <p class="text-gray-600">${new Date(course.createdAt).toLocaleDateString('pl-PL')}</p>
                                    </div>
                                    <div>
                                        <strong class="text-gray-900">Ostatnia aktualizacja:</strong>
                                        <p class="text-gray-600">${new Date(course.updatedAt).toLocaleDateString('pl-PL')}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="p-6 border-t border-gray-200 flex justify-end space-x-4">
                                <button data-action="edit-preview" data-id="${course._id}" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                                    <i class="ri-edit-line mr-2"></i>
                                    Edytuj kurs
                                </button>
                                <button data-action="close-preview" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors">
                                    Zamknij
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Add event listeners
                modal.querySelectorAll('[data-action="close-preview"]').forEach(button => {
                    button.addEventListener('click', () => {
                        modal.remove();
                    });
                });
                
                const editBtn = modal.querySelector('[data-action="edit-preview"]');
                if (editBtn) {
                    editBtn.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.editCourse(id);
                        modal.remove();
                    });
                }
                
                // Close on outside click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            }

            async downloadMaterial(id) {
                try {
                    const response = await fetch(`/api/materials/admin/download/${id}`, { credentials: 'include' });
                    const data = await response.json();
                    
                    if (response.ok && data.downloadUrl) {
                        // Create download link with proper filename
                        const a = document.createElement('a');
                        a.href = data.downloadUrl;
                        a.download = data.fileName || 'material.pdf';
                        a.target = '_blank';
                        a.rel = 'noopener noreferrer';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        
                        this.showNotification('Pobieranie rozpoczƒôte...', 'success');
                    } else {
                        throw new Error(data.message || 'B≈ÇƒÖd pobierania materia≈Çu');
                    }
                } catch (error) {
                    this.showNotification('B≈ÇƒÖd pobierania materia≈Çu: ' + error.message, 'error');
                }
            }

            async editMaterial(id) {
                this.showMaterialModal(id);
            }

            async deleteMaterial(id) {
                if (confirm('Czy na pewno chcesz usunƒÖƒá ten materia≈Ç? Ta operacja jest nieodwracalna.')) {
                    try {
                        const response = await fetch(`/api/materials/${id}`, {
                            method: 'DELETE',
                            credentials: 'include'
                        });
                        
                        if (response.ok) {
                            this.showNotification('Materia≈Ç zosta≈Ç usuniƒôty', 'success');
                            this.loadMaterials(); // Reload list
                        } else {
                            const data = await response.json();
                            throw new Error(data.message || 'B≈ÇƒÖd usuwania');
                        }
                    } catch (error) {
                        this.showNotification('B≈ÇƒÖd usuwania materia≈Çu: ' + error.message, 'error');
                    }
                }
            }

            addEventListeners() {
                // Remove existing event listeners to avoid duplicates
                document.querySelectorAll('[data-action]').forEach(button => {
                    const newButton = button.cloneNode(true);
                    button.parentNode.replaceChild(newButton, button);
                });

                // Add event listeners for news actions
                document.querySelectorAll('[data-action="add-news"]').forEach(button => {
                    button.addEventListener('click', () => this.showNewsModal());
                });
                
                document.querySelectorAll('[data-action="edit-news"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.editNews(id);
                    });
                });
                
                document.querySelectorAll('[data-action="delete-news"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.deleteNews(id);
                    });
                });

                // Add event listeners for course actions
                document.querySelectorAll('[data-action="add-course"]').forEach(button => {
                    button.addEventListener('click', () => this.showCourseModal());
                });
                
                document.querySelectorAll('[data-action="edit-course"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.editCourse(id);
                    });
                });
                
                document.querySelectorAll('[data-action="delete-course"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.deleteCourse(id);
                    });
                });

                // Add event listeners for job actions
                document.querySelectorAll('[data-action="add-job"]').forEach(button => {
                    button.addEventListener('click', () => this.showJobModal());
                });
                
                document.querySelectorAll('[data-action="edit-job"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.editJob(id);
                    });
                });
                
                document.querySelectorAll('[data-action="delete-job"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.deleteJob(id);
                    });
                });

                // Add event listeners for application actions
                document.querySelectorAll('[data-action="view-application"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.viewApplication(id);
                    });
                });
                
                document.querySelectorAll('[data-action="accept-application"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.updateApplicationStatus(id, 'accepted');
                    });
                });
                
                document.querySelectorAll('[data-action="reject-application"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.updateApplicationStatus(id, 'rejected');
                    });
                });
                
                document.querySelectorAll('[data-action="delete-application"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.deleteApplication(id);
                    });
                });
                
                // Group toggle handlers (for courses)
                document.querySelectorAll('[data-action="toggle-group"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const groupElement = e.currentTarget.closest('.border');
                        const coursesDiv = groupElement.querySelector('.group-courses');
                        const icon = e.currentTarget.querySelector('.group-toggle-icon');
                        
                        if (coursesDiv.classList.contains('hidden')) {
                            coursesDiv.classList.remove('hidden');
                            icon.classList.remove('ri-arrow-down-s-line');
                            icon.classList.add('ri-arrow-up-s-line');
                        } else {
                            coursesDiv.classList.add('hidden');
                            icon.classList.remove('ri-arrow-up-s-line');
                            icon.classList.add('ri-arrow-down-s-line');
                        }
                    });
                });
                
                // Application group toggle handlers
                document.querySelectorAll('[data-action="toggle-application-group"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const groupElement = e.currentTarget.closest('.border');
                        const contentDiv = groupElement.querySelector('.application-group-content');
                        const icon = e.currentTarget.querySelector('.application-group-toggle-icon');
                        
                        if (contentDiv.classList.contains('hidden')) {
                            contentDiv.classList.remove('hidden');
                            icon.classList.remove('ri-arrow-down-s-line');
                            icon.classList.add('ri-arrow-up-s-line');
                        } else {
                            contentDiv.classList.add('hidden');
                            icon.classList.remove('ri-arrow-up-s-line');
                            icon.classList.add('ri-arrow-down-s-line');
                        }
                    });
                });
                
                // Job Application group toggle handlers
                document.querySelectorAll('[data-action="toggle-job-application-group"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const groupElement = e.currentTarget.closest('.border');
                        const contentDiv = groupElement.querySelector('.job-application-group-content');
                        const icon = e.currentTarget.querySelector('.job-application-group-toggle-icon');
                        
                        if (contentDiv.classList.contains('hidden')) {
                            contentDiv.classList.remove('hidden');
                            icon.classList.remove('ri-arrow-down-s-line');
                            icon.classList.add('ri-arrow-up-s-line');
                        } else {
                            contentDiv.classList.add('hidden');
                            icon.classList.remove('ri-arrow-up-s-line');
                            icon.classList.add('ri-arrow-down-s-line');
                        }
                    });
                });
                
                // Material action handlers
                document.querySelectorAll('[data-action="preview-material"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.previewMaterial(id);
                    });
                });
                
                document.querySelectorAll('[data-action="preview-course"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.previewCourse(id);
                    });
                });
                
                document.querySelectorAll('[data-action="download-material"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.downloadMaterial(id);
                    });
                });
                
                document.querySelectorAll('[data-action="edit-material"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.editMaterial(id);
                    });
                });
                
                document.querySelectorAll('[data-action="delete-material"]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.currentTarget.dataset.id;
                        this.deleteMaterial(id);
                    });
                });

            }

            formatText(action, targetField) {
                const textarea = document.querySelector(`textarea[name="${targetField}"]`);
                if (!textarea) return;

                const start = textarea.selectionStart;
                const end = textarea.selectionEnd;
                const selectedText = textarea.value.substring(start, end);
                
                if (selectedText === '') {
                    alert('Zaznacz tekst do formatowania');
                    return;
                }

                let formattedText = '';
                
                switch (action) {
                    case 'format-bold':
                        formattedText = `<strong>${selectedText}</strong>`;
                        break;
                    case 'format-italic':
                        formattedText = `<em>${selectedText}</em>`;
                        break;
                    case 'format-list':
                        const listItems = selectedText.split('\n').filter(item => item.trim()).map(item => `<li>${item.trim()}</li>`).join('\n');
                        formattedText = `<ul>\n${listItems}\n</ul>`;
                        break;
                    case 'format-heading':
                        formattedText = `<h3>${selectedText}</h3>`;
                        break;
                    case 'format-link':
                        const url = prompt('Podaj adres URL:', 'https://');
                        if (url && url !== 'https://') {
                            formattedText = `<a href="${url}" target="_blank" rel="noopener noreferrer">${selectedText}</a>`;
                        } else {
                            return;
                        }
                        break;
                    default:
                        return;
                }

                // Replace selected text with formatted version
                const newValue = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
                textarea.value = newValue;
                
                // Set cursor position after formatted text
                const newCursorPos = start + formattedText.length;
                textarea.setSelectionRange(newCursorPos, newCursorPos);
                textarea.focus();
            }

            async handleNewsImageUpload(file) {
                if (!file) return;
                
                // Validate file size (5MB)
                if (file.size > 5 * 1024 * 1024) {
                    this.showNotification('Plik jest za du≈ºy. Maksymalny rozmiar to 5MB.', 'error');
                    return;
                }
                
                // Validate file type
                if (!file.type.startsWith('image/')) {
                    this.showNotification('Mo≈ºna wgraƒá tylko pliki obraz√≥w (JPG, PNG, GIF).', 'error');
                    return;
                }
                
                const progressDiv = document.getElementById('news-upload-progress');
                const progressBar = progressDiv.querySelector('.bg-blue-600');
                const previewDiv = document.getElementById('news-image-preview');
                const previewImg = document.getElementById('news-preview-img');
                const imageUrlInput = document.getElementById('news-image-url');
                const removeBtn = document.querySelector('[data-action="remove-news-image"]');
                
                try {
                    // Show progress
                    progressDiv.classList.remove('hidden');
                    progressBar.style.width = '0%';
                    
                    // Create FormData
                    const formData = new FormData();
                    formData.append('image', file);
                    
                    // Upload to server
                    const response = await fetch('/api/news/upload-image', {
                        method: 'POST',
                        credentials: 'include',
                        body: formData
                    });
                    
                    progressBar.style.width = '100%';
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'B≈ÇƒÖd uploadu');
                    }
                    
                    const result = await response.json();
                    
                    // Update UI
                    imageUrlInput.value = result.imageUrl;
                    previewImg.src = result.imageUrl;
                    previewDiv.classList.remove('hidden');
                    removeBtn.classList.remove('hidden');
                    progressDiv.classList.add('hidden');
                    
                    this.showNotification('Zdjƒôcie zosta≈Ço wgrane pomy≈õlnie!', 'success');
                    
                } catch (error) {
                    progressDiv.classList.add('hidden');
                    this.showNotification('B≈ÇƒÖd podczas wgrywania zdjƒôcia: ' + error.message, 'error');
                }
            }

            removeNewsImage() {
                const imageUrlInput = document.getElementById('news-image-url');
                const previewDiv = document.getElementById('news-image-preview');
                const removeBtn = document.querySelector('[data-action="remove-news-image"]');
                
                imageUrlInput.value = '';
                previewDiv.classList.add('hidden');
                removeBtn.classList.add('hidden');
                
                this.showNotification('Zdjƒôcie zosta≈Ço usuniƒôte', 'success');
            }

            async handleMaterialFileUpload(file) {
                console.log('üìÅ Starting file upload:', file?.name, 'Size:', file?.size, 'Type:', file?.type);
                if (!file) {
                    console.warn('‚ùå No file provided to upload');
                    return;
                }
                
                // Validate file size (10MB for materials)
                const maxSize = 10 * 1024 * 1024; // 10MB
                console.log(`üìè File size check: ${file.size} bytes (max: ${maxSize})`);
                if (file.size > maxSize) {
                    console.warn('‚ùå File too large:', file.size, 'bytes');
                    this.showNotification('Plik jest za du≈ºy. Maksymalny rozmiar to 10MB.', 'error');
                    return;
                }
                
                // Validate file type
                const allowedTypes = [
                    'application/pdf',
                    'application/msword',
                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                    'application/vnd.ms-powerpoint',
                    'application/vnd.openxmlformats-officedocument.presentationml.presentation',
                    'application/vnd.ms-excel',
                    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                    'application/zip',
                    'application/x-rar-compressed'
                ];
                
                console.log('üîç File type check:', file.type, 'Allowed:', allowedTypes.includes(file.type));
                if (!allowedTypes.includes(file.type)) {
                    console.warn('‚ùå Unsupported file type:', file.type);
                    this.showNotification('Nieobs≈Çugiwany typ pliku. Obs≈Çugiwane formaty: PDF, DOC, DOCX, PPT, PPTX, XLS, XLSX, ZIP, RAR', 'error');
                    return;
                }
                
                const progressDiv = document.getElementById('material-upload-progress');
                const progressBar = progressDiv.querySelector('.bg-green-600');
                const fileUrlInput = document.querySelector('input[name="fileUrl"]');
                
                try {
                    console.log('üöÄ Starting upload process...');
                    // Show progress
                    progressDiv.classList.remove('hidden');
                    progressBar.style.width = '0%';
                    
                    // Create FormData
                    const formData = new FormData();
                    formData.append('file', file);
                    console.log('üì¶ FormData created with file');
                    
                    // Upload to server
                    console.log('üåê Sending request to /api/materials/upload-file');
                    const response = await fetch('/api/materials/upload-file', {
                        method: 'POST',
                        credentials: 'include',
                        body: formData
                    });
                    console.log('üì° Response received:', response.status, response.statusText);
                    
                    progressBar.style.width = '100%';
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error('‚ùå Upload failed:', response.status, errorData);
                        throw new Error(errorData.message || 'B≈ÇƒÖd uploadu');
                    }
                    
                    const result = await response.json();
                    console.log('‚úÖ Upload successful:', result);
                    
                    // Update UI
                    fileUrlInput.value = result.fileUrl;
                    progressDiv.classList.add('hidden');
                    
                    this.showNotification('Plik zosta≈Ç wgrany pomy≈õlnie!', 'success');
                    
                } catch (error) {
                    console.error('üí• Error uploading file:', error);
                    progressDiv.classList.add('hidden');
                    this.showNotification('B≈ÇƒÖd podczas wgrywania pliku: ' + error.message, 'error');
                }
            }

            async logout() {
                if (confirm('Czy na pewno chcesz siƒô wylogowaƒá?')) {
                    try {
                        await fetch('/api/auth/logout', {
                            method: 'POST',
                            credentials: 'include'
                        });
                    } catch (error) {
                        console.error('Logout error:', error);
                    }
                    
                    window.location.href = '/admin-login.html';
                }
            }

            // Check user permissions for admin actions
            async checkUserPermissions() {
                try {
                    console.log('üîë Checking user permissions...');
                    const response = await fetch('/api/auth/me', { credentials: 'include' });
                    const data = await response.json();
                    
                    if (response.ok && data.user) {
                        console.log('üë§ Current user:', data.user.email, 'Role:', data.user.role);
                        
                        if (data.user.role !== 'admin') {
                            console.warn('‚ö†Ô∏è User is not admin, showing permission message');
                            const container = document.getElementById('users-list');
                            container.innerHTML = `
                                <div class="text-center py-8 text-amber-600">
                                    <i class="ri-shield-line text-4xl mb-2"></i>
                                    <p class="font-semibold">Brak uprawnie≈Ñ administratora</p>
                                    <p class="text-sm text-gray-500 mb-4">Twoja rola: ${data.user.role}</p>
                                    <p class="text-sm text-gray-500">Tylko administratorzy mogƒÖ zarzƒÖdzaƒá u≈ºytkownikami</p>
                                </div>
                            `;
                            return false;
                        }
                        return true;
                    }
                } catch (error) {
                    console.error('‚ùå Error checking permissions:', error);
                }
                return false;
            }

            // Users management
            async loadUsers() {
                try {
                    console.log('üîç Loading users...');
                    const response = await fetch('/api/auth/users', { credentials: 'include' });
                    console.log('üì° Users API response status:', response.status);
                    
                    if (response.status === 403) {
                        const container = document.getElementById('users-list');
                        container.innerHTML = `
                            <div class="text-center py-8 text-red-500">
                                <i class="ri-shield-line text-4xl mb-2"></i>
                                <p class="font-semibold">Brak uprawnie≈Ñ</p>
                                <p class="text-sm text-gray-500 mb-4">Tylko administratorzy mogƒÖ zarzƒÖdzaƒá u≈ºytkownikami</p>
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 max-w-md mx-auto">
                                    <p class="text-sm text-yellow-800 mb-3">Je≈õli jeste≈õ pierwszym u≈ºytkownikiem, mo≈ºesz awansowaƒá swoje konto na administratora:</p>
                                    <button onclick="promoteToAdmin()" class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 text-sm">
                                        Zosta≈Ñ administratorem
                                    </button>
                                </div>
                            </div>
                        `;
                        return;
                    }
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        this.users = data.users || [];
                        this.renderUsers();
                    } else {
                        throw new Error(data.message || 'B≈ÇƒÖd ≈Çadowania u≈ºytkownik√≥w');
                    }
                } catch (error) {
                    console.error('Error loading users:', error);
                    
                    const container = document.getElementById('users-list');
                    container.innerHTML = `
                        <div class="text-center py-8 text-red-500">
                            <i class="ri-error-warning-line text-4xl mb-2"></i>
                            <p class="font-semibold">B≈ÇƒÖd ≈Çadowania u≈ºytkownik√≥w</p>
                            <p class="text-sm text-gray-500">${error.message}</p>
                            <button onclick="window.adminPanel.loadUsers()" class="mt-3 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark">
                                Spr√≥buj ponownie
                            </button>
                        </div>
                    `;
                }
            }

            filterUsers() {
                const roleFilter = document.getElementById('users-role-filter').value;
                const statusFilter = document.getElementById('users-status-filter').value;
                
                let filteredUsers = this.users;
                
                if (roleFilter) {
                    filteredUsers = filteredUsers.filter(user => user.role === roleFilter);
                }
                
                if (statusFilter !== '') {
                    const isActive = statusFilter === 'true';
                    filteredUsers = filteredUsers.filter(user => user.isActive === isActive);
                }
                
                this.renderUsers(filteredUsers);
            }

            renderUsers(users = this.users) {
                const container = document.getElementById('users-list');
                
                if (users.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <i class="ri-user-line text-4xl mb-2"></i>
                            <p>Brak u≈ºytkownik√≥w</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = users.map(user => `
                    <div class="border border-gray-200 rounded-lg p-4 bg-white hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <div class="flex-shrink-0">
                                        <div class="w-10 h-10 bg-primary-light text-white rounded-full flex items-center justify-center">
                                            <i class="ri-user-line"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900">${user.firstName} ${user.lastName}</h3>
                                        <p class="text-gray-600 text-sm">${user.email}</p>
                                    </div>
                                </div>
                                
                                <div class="flex flex-wrap gap-2 text-xs">
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${this.getRoleBadgeColor(user.role)}">${this.getRoleLabel(user.role)}</span>
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${user.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${user.isActive ? 'Aktywny' : 'Nieaktywny'}</span>
                                    ${user.isVerified ? '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">Zweryfikowany</span>' : ''}
                                    ${user.companyName ? `<span class="text-gray-500">${user.companyName}</span>` : ''}
                                </div>
                                
                                <div class="mt-2 text-xs text-gray-500">
                                    <span>Zarejestrowany: ${new Date(user.createdAt).toLocaleDateString('pl-PL')}</span>
                                    ${user.lastLogin ? `<span class="ml-4">Ostatnie logowanie: ${new Date(user.lastLogin).toLocaleDateString('pl-PL')}</span>` : ''}
                                </div>
                            </div>
                            
                            <div class="flex space-x-2">
                                <button onclick="editUser('${user._id}')" class="text-blue-600 hover:text-blue-800 px-3 py-1 rounded border border-blue-200 hover:border-blue-300 text-sm">
                                    <i class="ri-edit-line mr-1"></i>Edytuj
                                </button>
                                <button onclick="deleteUser('${user._id}', '${user.firstName} ${user.lastName}')" class="text-red-600 hover:text-red-800 px-3 py-1 rounded border border-red-200 hover:border-red-300 text-sm">
                                    <i class="ri-delete-bin-line mr-1"></i>Usu≈Ñ
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            getRoleLabel(role) {
                const labels = {
                    'admin': 'Administrator',
                    'wykladowca': 'Wyk≈Çadowca',
                    'redaktor': 'Redaktor',
                    'pracodawca': 'Pracodawca',
                    'kursant': 'Kursant'
                };
                return labels[role] || role;
            }

            getRoleBadgeColor(role) {
                const colors = {
                    'admin': 'bg-purple-100 text-purple-800',
                    'wykladowca': 'bg-blue-100 text-blue-800',
                    'redaktor': 'bg-green-100 text-green-800',
                    'pracodawca': 'bg-orange-100 text-orange-800',
                    'kursant': 'bg-gray-100 text-gray-800'
                };
                return colors[role] || 'bg-gray-100 text-gray-800';
            }
        }

        // Global functions for user management
        window.editUser = function(userId) {
            const user = window.adminPanel.users.find(u => u._id === userId);
            if (!user) return;
            
            window.adminPanel.currentUser = user;
            
            // Populate form
            document.getElementById('user-role').value = user.role;
            document.getElementById('user-active').checked = user.isActive;
            document.getElementById('user-verified').checked = user.isVerified;
            document.getElementById('user-modal-title').textContent = `Edytuj: ${user.firstName} ${user.lastName}`;
            
            // Show modal
            const modal = document.getElementById('user-modal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        window.hideUserModal = function() {
            const modal = document.getElementById('user-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            window.adminPanel.currentUser = null;
        }

        window.saveUser = async function() {
            if (!window.adminPanel.currentUser) return;
            
            const form = document.getElementById('user-form');
            const formData = new FormData(form);
            
            const updates = {
                role: formData.get('role'),
                isActive: formData.get('isActive') === 'on',
                isVerified: formData.get('isVerified') === 'on'
            };
            
            try {
                const response = await fetch(`/api/auth/users/${window.adminPanel.currentUser._id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(updates)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    window.adminPanel.showNotification('U≈ºytkownik zosta≈Ç zaktualizowany', 'success');
                    window.hideUserModal();
                    window.adminPanel.loadUsers();
                } else {
                    throw new Error(result.message || 'B≈ÇƒÖd aktualizacji u≈ºytkownika');
                }
            } catch (error) {
                console.error('Error updating user:', error);
                window.adminPanel.showNotification('B≈ÇƒÖd aktualizacji: ' + error.message, 'error');
            }
        }

        window.deleteUser = async function(userId, userName) {
            if (!confirm(`Czy na pewno chcesz usunƒÖƒá u≈ºytkownika ${userName}? Ta operacja jest nieodwracalna.`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/auth/users/${userId}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    window.adminPanel.showNotification('U≈ºytkownik zosta≈Ç usuniƒôty', 'success');
                    window.adminPanel.loadUsers();
                } else {
                    throw new Error(result.message || 'B≈ÇƒÖd usuwania u≈ºytkownika');
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                window.adminPanel.showNotification('B≈ÇƒÖd usuwania: ' + error.message, 'error');
            }
        }

        // Test Material Upload function
        window.testMaterialUpload = function() {
            console.log('üß™ Testing Material Upload System...');
            
            // Check if modal elements exist
            const modal = document.getElementById('material-modal');
            const uploadBtn = document.querySelector('[data-action="upload-material-file"]');
            const fileInput = document.getElementById('material-file-upload');
            
            console.log('üîç Modal elements check:');
            console.log('Modal:', modal);
            console.log('Upload button:', uploadBtn);
            console.log('File input:', fileInput);
            
            // Test opening modal
            try {
                console.log('üìù Opening material modal...');
                window.adminPanel.showMaterialModal();
                
                setTimeout(() => {
                    const modalAfter = document.getElementById('material-modal');
                    const uploadBtnAfter = document.querySelector('[data-action="upload-material-file"]');
                    const fileInputAfter = document.getElementById('material-file-upload');
                    
                    console.log('üîç After modal open:');
                    console.log('Modal visible:', !modalAfter?.classList.contains('hidden'));
                    console.log('Upload button:', uploadBtnAfter);
                    console.log('File input:', fileInputAfter);
                    
                    if (uploadBtnAfter) {
                        console.log('‚úÖ Upload system seems to be working');
                        
                        // Test API endpoint
                        console.log('üß™ Testing upload API endpoint...');
                        fetch('/api/materials/upload-file', {
                            method: 'POST',
                            credentials: 'include',
                            body: new FormData() // Empty form to test endpoint existence
                        })
                        .then(response => {
                            console.log('üì° Upload API response:', response.status);
                            if (response.status === 400) {
                                console.log('‚úÖ API endpoint exists (400 = no file provided)');
                                alert('‚úÖ System uploadu dzia≈Ça!\n\nEndpoint API: ‚úÖ\nInterfejs: ‚úÖ\n\nMo≈ºesz teraz testowaƒá upload plik√≥w');
                            } else {
                                console.log('‚ö†Ô∏è Unexpected API response:', response.status);
                                alert('‚ö†Ô∏è API endpoint odpowiada, ale z nieoczekiwanym statusem: ' + response.status);
                            }
                        })
                        .catch(error => {
                            console.error('‚ùå API test failed:', error);
                            alert('‚ùå Problem z API: ' + error.message);
                        });
                        
                    } else {
                        console.error('‚ùå Upload button not found after modal open');
                        alert('‚ùå Problem z przyciskiem uploadu\n\nSprawd≈∫ console.log');
                    }
                }, 500);
                
            } catch (error) {
                console.error('üí• Error testing upload:', error);
                alert('üí• B≈ÇƒÖd testowania: ' + error.message);
            }
        }

        // Test Users API function
        window.testUsersAPI = async function() {
            console.log('üß™ Testing Users API...');
            
            try {
                // Test /api/auth/me first
                console.log('1Ô∏è‚É£ Testing /api/auth/me...');
                const meResponse = await fetch('/api/auth/me', { credentials: 'include' });
                const meData = await meResponse.json();
                console.log('üë§ Me Response:', meResponse.status, meData);
                
                // Test /api/auth/users
                console.log('2Ô∏è‚É£ Testing /api/auth/users...');
                const usersResponse = await fetch('/api/auth/users', { credentials: 'include' });
                console.log('üë• Users Response Status:', usersResponse.status);
                
                if (usersResponse.ok) {
                    const usersData = await usersResponse.json();
                    console.log('‚úÖ Users Data:', usersData);
                    alert(`‚úÖ API dzia≈Ça!\n\nTwoja rola: ${meData.user?.role}\nZnaleziono ${usersData.users?.length || 0} u≈ºytkownik√≥w`);
                } else {
                    const errorData = await usersResponse.json();
                    console.log('‚ùå Users Error:', errorData);
                    alert(`‚ùå B≈ÇƒÖd API: ${usersResponse.status}\n${errorData.message || 'Nieznany b≈ÇƒÖd'}\n\nTwoja rola: ${meData.user?.role}`);
                }
                
            } catch (error) {
                console.error('üí• Test Error:', error);
                alert(`üí• B≈ÇƒÖd testu: ${error.message}`);
            }
        }

        // Promote current user to admin (emergency function)
        window.promoteToAdmin = async function() {
            if (!confirm('Czy na pewno chcesz awansowaƒá swoje konto na administratora? Ta akcja jest mo≈ºliwa tylko je≈õli nie ma innych administrator√≥w w systemie.')) {
                return;
            }
            
            try {
                // Get current user email from session
                const statusResponse = await fetch('/api/auth/me', { credentials: 'include' });
                const statusData = await statusResponse.json();
                
                if (!statusResponse.ok || !statusData.user) {
                    throw new Error('Nie mo≈ºna pobraƒá danych u≈ºytkownika');
                }
                
                const response = await fetch('/api/auth/promote-admin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ email: statusData.user.email })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    alert('Konto zosta≈Ço awansowane na administratora! Od≈õwie≈º stronƒô aby zobaczyƒá zmiany.');
                    window.location.reload();
                } else {
                    throw new Error(result.message || 'B≈ÇƒÖd awansowania na administratora');
                }
            } catch (error) {
                console.error('Promote admin error:', error);
                alert('B≈ÇƒÖd awansowania: ' + error.message);
            }
        }

        // Initialize admin panel
        const adminPanel = new AdminPanel();
        window.adminPanel = adminPanel;
    </script>

    <!-- Application Detail Modal -->
    <div id="applicationModal" class="application-modal">
        <div class="application-content">
            <!-- Modal Header (Not Printed) -->
            <div class="no-print p-6 border-b border-gray-200 flex justify-between items-center">
                <h2 class="text-xl font-semibold text-gray-800">Szczeg√≥≈Çy zg≈Çoszenia</h2>
                <div class="flex space-x-3">
                    <button id="printApplicationBtn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors flex items-center space-x-2">
                        <i class="ri-printer-line"></i>
                        <span>Drukuj</span>
                    </button>
                    <button id="closeApplicationModal" class="text-gray-500 hover:text-gray-700 text-2xl">
                        <i class="ri-close-line"></i>
                    </button>
                </div>
            </div>
            
            <!-- Application Content (Printable) -->
            <div id="applicationPrintContent" class="application-print-content p-8">
                <!-- Header -->
                <div class="print-header">
                    <div class="print-logo">BCU SPEDYCJA</div>
                    <div class="print-subtitle">Bran≈ºowe Centrum Umiejƒôtno≈õci Spedycja</div>
                    <div style="font-size: 12pt; color: #666;">
                        Zg≈Çoszenie na kurs szkoleniowy
                    </div>
                </div>

                <!-- Application Details -->
                <div id="applicationDetails">
                    <!-- Content will be populated by JavaScript -->
                </div>

                <!-- Footer -->
                <div class="print-footer">
                    <div>BCU SPEDYCJA - Bran≈ºowe Centrum Umiejƒôtno≈õci Spedycja</div>
                    <div>Data wydruku: <span id="printDate"></span></div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
